!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=3)}([function(t,e,s){t.exports=s.p+"61dd95180de5ed97d4a74e36347ea6b5.png"},function(t,e,s){t.exports=s.p+"273cf78eda1acf7bdb8bd032095ea00c.png"},function(t,e,s){!function(){function e(t,e){document.addEventListener?t.addEventListener("scroll",e,!1):t.attachEvent("scroll",e)}function s(t){this.a=document.createElement("div"),this.a.setAttribute("aria-hidden","true"),this.a.appendChild(document.createTextNode(t)),this.b=document.createElement("span"),this.c=document.createElement("span"),this.h=document.createElement("span"),this.f=document.createElement("span"),this.g=-1,this.b.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.c.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.f.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.h.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;",this.b.appendChild(this.h),this.c.appendChild(this.f),this.a.appendChild(this.b),this.a.appendChild(this.c)}function i(t,e){t.a.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;white-space:nowrap;font-synthesis:none;font:"+e+";"}function n(t){var e=t.a.offsetWidth,s=e+100;return t.f.style.width=s+"px",t.c.scrollLeft=s,t.b.scrollLeft=t.b.scrollWidth+100,t.g!==e&&(t.g=e,!0)}function r(t,s){function i(){var t=r;n(t)&&t.a.parentNode&&s(t.g)}var r=t;e(t.b,i),e(t.c,i),n(t)}function a(t,e){var s=e||{};this.family=t,this.style=s.style||"normal",this.weight=s.weight||"normal",this.stretch=s.stretch||"normal"}var o=null,h=null,l=null,d=null;function c(){return null===d&&(d=!!document.fonts),d}function u(){if(null===l){var t=document.createElement("div");try{t.style.font="condensed 100px sans-serif"}catch(t){}l=""!==t.style.font}return l}function _(t,e){return[t.style,t.weight,u()?t.stretch:"","100px",e].join(" ")}a.prototype.load=function(t,e){var n=this,a=t||"BESbswy",l=0,d=e||3e3,u=(new Date).getTime();return new Promise((function(t,e){if(c()&&!function(){if(null===h)if(c()&&/Apple/.test(window.navigator.vendor)){var t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))(?:\.([0-9]+))/.exec(window.navigator.userAgent);h=!!t&&603>parseInt(t[1],10)}else h=!1;return h}()){var m=new Promise((function(t,e){!function s(){(new Date).getTime()-u>=d?e(Error(d+"ms timeout exceeded")):document.fonts.load(_(n,'"'+n.family+'"'),a).then((function(e){1<=e.length?t():setTimeout(s,25)}),e)}()})),p=new Promise((function(t,e){l=setTimeout((function(){e(Error(d+"ms timeout exceeded"))}),d)}));Promise.race([p,m]).then((function(){clearTimeout(l),t(n)}),e)}else!function(t){document.body?t():document.addEventListener?document.addEventListener("DOMContentLoaded",(function e(){document.removeEventListener("DOMContentLoaded",e),t()})):document.attachEvent("onreadystatechange",(function e(){"interactive"!=document.readyState&&"complete"!=document.readyState||(document.detachEvent("onreadystatechange",e),t())}))}((function(){function h(){var e;(e=-1!=g&&-1!=f||-1!=g&&-1!=w||-1!=f&&-1!=w)&&((e=g!=f&&g!=w&&f!=w)||(null===o&&(e=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),o=!!e&&(536>parseInt(e[1],10)||536===parseInt(e[1],10)&&11>=parseInt(e[2],10))),e=o&&(g==v&&f==v&&w==v||g==y&&f==y&&w==y||g==D&&f==D&&w==D)),e=!e),e&&(b.parentNode&&b.parentNode.removeChild(b),clearTimeout(l),t(n))}var c=new s(a),m=new s(a),p=new s(a),g=-1,f=-1,w=-1,v=-1,y=-1,D=-1,b=document.createElement("div");b.dir="ltr",i(c,_(n,"sans-serif")),i(m,_(n,"serif")),i(p,_(n,"monospace")),b.appendChild(c.a),b.appendChild(m.a),b.appendChild(p.a),document.body.appendChild(b),v=c.a.offsetWidth,y=m.a.offsetWidth,D=p.a.offsetWidth,function t(){if((new Date).getTime()-u>=d)b.parentNode&&b.parentNode.removeChild(b),e(Error(d+"ms timeout exceeded"));else{var s=document.hidden;!0!==s&&void 0!==s||(g=c.a.offsetWidth,f=m.a.offsetWidth,w=p.a.offsetWidth,h()),l=setTimeout(t,50)}}(),r(c,(function(t){g=t,h()})),i(c,_(n,'"'+n.family+'",sans-serif')),r(m,(function(t){f=t,h()})),i(m,_(n,'"'+n.family+'",serif')),r(p,(function(t){w=t,h()})),i(p,_(n,'"'+n.family+'",monospace'))}))}))},t.exports=a}()},function(t,e,s){"use strict";s.r(e);class i{constructor(t,e){this._x=t||0,this._y=e||0}get x(){return this._x}get y(){return this._y}get magnitude(){return Math.sqrt(this._x*this._x+this._y*this._y)}get isZero(){return 0===this.x&&0===this.y}static add(t,e){let s=t.x+e.x,n=t.y+e.y;return new i(s,n)}static minus(t,e){if(!e)return this.minus(new i(0,0),t);let s=t.x-e.x,n=t.y-e.y;return new i(s,n)}static multiply(t,e){return e instanceof i?new i(t.x*e.x,t.y*e.y):new i(t.x*e,t.y*e)}static dotProduct(t,e){return t.x*e.x+t.y*e.y}static divide(t,e){let s=t.x/e,n=t.y/e;return new i(s,n)}static crossProduct(t,e){return t.x*e.y-t.y*e.x}static equals(t,e){return t.x===e.x&&t.y===e.y}static distance(t,e){let s=t.x-e.x,i=t.y-e.y;return Math.sqrt(s*s+i*i)}rotate(t){let e=Math.cos(t)*this._x+-Math.sin(t)*this._y,s=Math.sin(t)*this._x+Math.cos(t)*this._y;return new i(e,s)}closestPoint(t){let e,s=void 0;return t.forEach(t=>{let n=i.minus(t,this).magnitude;(void 0===s||n<s)&&(s=n,e=t)}),e}get normalised(){return i.divide(this,this.magnitude)}static angleBetween(t,e){return Math.atan2(e.y,e.x)-Math.atan2(t.y,t.x)}projectionIn(t){return i.dotProduct(this,t.normalised)}static angleToUnitVector(t){return new i(Math.cos(t),Math.sin(t))}asAngle(){return Math.atan2(this.x,this.y)}}class n{constructor(t,e,s){this._x=0,this._y=0,this._anchorX=0,this._anchorY=0,this._updated=!1,t instanceof i?(this._x=t.x,this._y=t.y,e instanceof i&&(this.anchorX=e.x,this.anchorY=e.y)):("number"==typeof t&&"number"==typeof e&&(this._x=t,this._y=e),s&&(this.anchorX=s.x,this.anchorY=s.y))}get updated(){return this._updated}set updated(t){this._updated=t}markAsUpdated(){this._updated=!0}get innerX(){return this._x}set innerX(t){t!==this._x&&(this._x=t,this._updated=!0)}get innerY(){return this._y}set innerY(t){t!==this._y&&(this._y=t,this._updated=!0)}getOffsetX(t){return this._x}getOffsetY(t){return this._y}getAnchorOffsetX(t){return t.width()*this._anchorX}getAnchorOffsetY(t){return t.height()*this._anchorY}getOffsetXTopLeft(t){return this.getOffsetX(t)-this.getAnchorOffsetX(t)}getOffsetYTopLeft(t){return this.getOffsetY(t)-this.getAnchorOffsetY(t)}get anchorX(){return this._anchorX}get anchorY(){return this._anchorY}set anchorX(t){t!==this._anchorX&&(this._updated=!0),this._anchorX=t}set anchorY(t){t!==this._anchorY&&(this._updated=!0),this._anchorY=t}destroy(){}}class r extends n{constructor(t,e){e instanceof i?super(0,0,e):super(0,0),this._conditionalFunction=t,this.updateSpecial=!0}get previousAbsolutePosition(){return this._previousAbsolutePosition}getOffsetX(t){return this.absolutePosition(t).x}getOffsetY(t){return this.absolutePosition(t).y}absolutePosition(t){let e=void 0,s=void 0;return t.parentBounds&&(e=t.parentBounds.width(),s=t.parentBounds.height()),this._previousAbsolutePosition=this._conditionalFunction(t.transform,e,s),this._previousAbsolutePosition}absolutePositionDontUpdatePrevious(t){return this._conditionalFunction(t.transform,t.parentBounds.width(),t.parentBounds.height())}}class a{constructor(t,e){this._updated=!1,this._width=t,this._height=e}get updated(){return this._updated}set updated(t){this._updated=t}markAsUpdated(){this._updated=!0}get width(){return this._width}set width(t){t!==this.width&&(this.updated=!0),this._width=t}get height(){return this._height}set height(t){t!==this._height&&(this.updated=!0),this._height=t}pixelWidth(t){return this._width}pixelHeight(t){return this._height}physicalPixelWidth(t){return this.pixelWidth(t)*t.devicePixelRatio}physicalPixelHeight(t){return this.pixelHeight(t)*t.devicePixelRatio}get aspect(){return this.height/this.width}destroy(){}static add(t,e){return new a(t.width+e.width,t.height+e.height)}static equals(t,e){return t.width===e.width&&t.height===e.height}}class o extends a{constructor(t,e,s){super(t,e),s&&(this._referenceBounds=s,this._referenceBounds.onResize.push(this.markAsUpdated.bind(this),this))}pixelWidth(t){return this._referenceBounds?this._referenceBounds.calculating?this.width*this._referenceBounds.cachedWidth:this.width*this._referenceBounds.width():t?this.width*t.width():0}pixelHeight(t){return this._referenceBounds?this._referenceBounds.calculating?this.height*this._referenceBounds.cachedHeight:this.height*this._referenceBounds.height():t?this.height*t.height():0}destroy(){this._referenceBounds&&this._referenceBounds.onResize.unregister(this)}}class h{constructor(t,e){this.key=t,this.value=e}}class l{constructor(){this.entries=[]}get length(){return this.entries.length}push(t,e){this.entries.push(new h(t,e))}delete(t,e){let s=[];this.entries.forEach(i=>{i.key!==t?s.push(i):e&&i.value!==e&&s.push(i)}),this.entries=s}deleteValue(t){let e=[];this.entries.forEach(s=>{s.value!==t&&e.push(s)}),this.entries=e}clear(){this.entries=[]}forEach(t){this.entries.forEach(t)}}class d{constructor(){this._callbacks=new l}call(...t){for(let e=0,s=this._callbacks.entries.length;e<s;e++)this._callbacks.entries[e].value(...t)}push(t,e){return this._callbacks.push(e,t),this}unregister(t){this._callbacks.delete(t)}remove(t){this._callbacks.deleteValue(t)}removeAll(){this._callbacks.clear()}get length(){return this._callbacks.length}clone(){let t=new(0,Object.getPrototypeOf(this).constructor);for(let e=0,s=this._callbacks.entries.length;e<s;e++)t.push(this._callbacks.entries[e].value,this._callbacks.entries[e].key);return t}static link(t,e,s){t&&e&&t.push(e.call.bind(e),s)}}class c extends d{call(){for(let t=0,e=this._callbacks.entries.length;t<e;t++)this._callbacks.entries[t].value()}push(t,e){return super.push(t,e)}}class u extends d{call(t){for(let e=0,s=this._callbacks.entries.length;e<s;e++)this._callbacks.entries[e].value(t)}push(t,e){return super.push(t,e)}}class _ extends d{call(t,e){for(let s=0,i=this._callbacks.entries.length;s<i;s++)this._callbacks.entries[s].value(t,e)}push(t,e){return super.push(t,e)}}class m extends _{call(t,e){super.call(t,e)}push(t,e){return super.push(t,e)}}class p{constructor(...t){this._dimensions=[],this._referenceWidth=void 0,this._targetAspectRatio=void 0,this._minDimension=void 0,this._maxDimension=void 0,this._transform=null,this._cachedWidth=0,this._cachedHeight=0,this._onResize=new c,this._dirty=!0,this._calculating=!1,this._dimensions=t}get transform(){return this._transform}set transform(t){this._transform=t}get dirty(){return this._dirty}set dirty(t){this._dirty=t}get cachedWidth(){return this._cachedWidth}get cachedHeight(){return this._cachedHeight}get calculating(){return this._calculating}get onResize(){return this._onResize}get devicePixelRatio(){return window.devicePixelRatio}get parentBounds(){return this.transform&&this.transform.parent?this.transform.parent.bounds:null}get targetAspectRatio(){return this._targetAspectRatio}set targetAspectRatio(t){this._targetAspectRatio=t}get maxDimension(){return this._maxDimension}set maxDimension(t){this._maxDimension=t}get minDimension(){return this._minDimension}set minDimension(t){this._minDimension=t}static get fill(){return new p(new o(1,1))}get dimensions(){return this._dimensions}width(){return this.dirty?(this._updateCache(),this._cachedWidth):this._cachedWidth}height(){return this.dirty?(this._updateCache(),this._cachedHeight):this._cachedHeight}asDimension(){return new a(this.width(),this.height())}aspect(){return this.height()/this.width()}get referenceWidth(){return void 0!==this._referenceWidth?this._referenceWidth:this.parentBounds?this.parentBounds.referenceWidth:void 0}set referenceWidth(t){this._referenceWidth=t}get referenceHeight(){return void 0!==this._referenceWidth?this.referenceWidth*this.aspect():this.parentBounds?this.parentBounds.referenceHeight:void 0}get referenceScale(){return void 0!==this._referenceWidth?this.width()/this._referenceWidth:this.parentBounds?this.parentBounds.referenceScale:0}addDimension(t){return this._dimensions.push(t),this.transform.gameObject.created&&this.hasResizedAutoUpdate()&&this._onChange(),t}clearDimensions(){this._dimensions=[],this.hasResizedAutoUpdate()&&this._onChange()}hasResizedAutoUpdate(){if(this.dirty)return!0;let t=this._cachedWidth,e=this._cachedHeight;return this._calculateAndSetDimension()||this._cachedWidth!==t||this._cachedHeight!==e}checkForUpdatedDimensions(){let t,e=!1;for(let s=0,i=this._dimensions.length;s<i;s++){if(t=this._dimensions[s],t.updated){e=!0;break}if(t.updateSpecial&&t.hasChanged(this.parentBounds)){e=!0;break}}if(e){this._onChange();for(let t=0,e=this._dimensions.length;t<e;t++)this._dimensions[t].updated=!1}}destroy(){this.onResize.removeAll();for(let t=0,e=this._dimensions.length;t<e;t++)this._dimensions[t].destroy()}_onChange(){this.transform&&(this.transform.recalculate(),this.onResize.call())}_updateCache(){let t=this._calculateAndSetDimension();this.dirty=t,t&&this.transform.positioningIsDirty()}_calculateAndSetDimension(){this._calculating=!0;let t=!1,e=0,s=0;if(this.transform)for(let i=0,n=this._dimensions.length;i<n;i++){let n=this._dimensions[i].pixelWidth(this.parentBounds),r=this._dimensions[i].pixelHeight(this.parentBounds);void 0===n||void 0===r?t=!0:(e+=n,s+=r)}return this._limitAndSetDimension(e,s),this._calculating=!1,t}_limitAndSetDimension(t,e){this.minDimension&&(this.minDimension.pixelWidth(this.parentBounds)&&(t=Math.max(t,this.minDimension.pixelWidth(this.parentBounds))),this.minDimension.pixelHeight(this.parentBounds)&&(e=Math.max(e,this.minDimension.pixelHeight(this.parentBounds)))),this.maxDimension&&(this.maxDimension.pixelWidth(this.parentBounds)&&(t=Math.min(t,this.maxDimension.pixelWidth(this.parentBounds))),this.maxDimension.pixelHeight(this.parentBounds)&&(e=Math.min(e,this.maxDimension.pixelHeight(this.parentBounds)))),this.targetAspectRatio&&(e<t*this.targetAspectRatio?t=e*(1/this.targetAspectRatio):e=t*this.targetAspectRatio),this._cachedWidth=t,this._cachedHeight=e}}class g extends n{constructor(t,e,s,n){t instanceof i?e instanceof i?(super(t,e),s instanceof p&&(this._referenceBounds=s)):(super(t),e instanceof p&&(this._referenceBounds=e)):"number"==typeof t&&"number"==typeof e&&(s instanceof i?(super(t,e,s),n&&(this._referenceBounds=n)):(super(t,e),s instanceof p&&(this._referenceBounds=s))),this._referenceBounds&&this._referenceBounds.onResize.push(this.markAsUpdated.bind(this),this)}get referenceBounds(){return this._referenceBounds}getOffsetX(t){let e=0;return this._referenceBounds?e=this._referenceBounds.width():t.parentBounds&&(e=t.parentBounds.width()),this.innerX*e}getOffsetY(t){let e=0;return this._referenceBounds?e=this._referenceBounds.height():t.parentBounds&&(e=t.parentBounds.height()),this.innerY*e}destroy(){this._referenceBounds&&this._referenceBounds.onResize.unregister(this)}}class f{constructor(...t){this._transform=null,this._resetDrawPos=!1,this._cachedX=0,this._cachedY=0,this._cacheXDirty=!0,this._cacheYDirty=!0,this._rotation=0,this._translations=t}get transform(){return this._transform}set transform(t){this._transform=t}get resetDrawPos(){return this._resetDrawPos}set resetDrawPos(t){this._resetDrawPos=t}get translations(){return this._translations}point(){return new i(this.x(),this.y())}get rotation(){return this._rotation}set rotation(t){this._rotation=t}static get right(){return new f(new g(1,0,new i(1,0)))}static get bottom(){return new f(new g(0,1,new i(0,1)))}static get bottomRight(){return new f(new g(1,1,new i(1,1)))}static get bottomCentre(){return new f(new g(.5,1,new i(.5,1)))}static get centre(){return new f(new g(.5,.5,new i(.5,.5)))}static get centreX(){return new f(new g(.5,0,new i(.5,0)))}static get centreY(){return new f(new g(0,.5,new i(0,.5)))}static get centreRight(){return new f(new g(1,.5,new i(1,.5)))}addTranslation(t){let e=null;for(let s=0;s<this._translations.length;s++){let i=this._translations[s];if(i.constructor===t.constructor&&i.anchorX==t.anchorX&&i.anchorY==t.anchorY)if(i instanceof g){i.referenceBounds===t.referenceBounds&&(e=i,i.innerX=i.innerX+t.innerX,i.innerY=i.innerY+t.innerY)}else i instanceof r||(e=i,i.innerX=i.innerX+t.innerX,i.innerY=i.innerY+t.innerY)}return e||this._translations.push(t),this.transform.gameObject.created&&this.hasMoved()&&this._onChange(),e||t}clearTranslations(){this._translations=[],this.hasMoved()&&this._onChange()}x(){if(!this._cacheXDirty)return this._cachedX;let t=this._calculateOffsetX();return this._cacheXDirty=!1,this._cachedX=t,t}y(){if(!this._cacheYDirty)return this._cachedY;let t=this._calculateOffsetY();return this._cacheYDirty=!1,this._cachedY=t,t}setCacheDirty(){this._cacheXDirty=!0,this._cacheYDirty=!0}anchorX(t){return this.x()+this.transform.bounds.width()*t}anchorY(t){return this.y()+this.transform.bounds.height()*t}getAnchorPosition(t,e){if(t){let s=this.point();return t instanceof i?new i(s.x+this.transform.bounds.width()*t.x,s.y+this.transform.bounds.height()*t.y):new i(s.x+this.transform.bounds.width()*t,s.y+this.transform.bounds.height()*e)}return this.point()}checkForUpdatedTranslations(){let t,e=!1;for(let s=0,n=this._translations.length;s<n;s++){if(t=this._translations[s],t.updated){e=!0;break}if(t.updateSpecial&&(!t.previousAbsolutePosition||!i.equals(t.absolutePositionDontUpdatePrevious(this.transform.bounds),t.previousAbsolutePosition))){e=!0;break}}e&&(this._onChange(),this._translations.forEach(t=>t.updated=!1))}hasMoved(){if(this._cacheXDirty||this._cacheYDirty)return!0;let t=this._calculateOffsetX(),e=this._calculateOffsetY();return t!==this._cachedX||e!==this._cachedY}hasMovedAutoUpdate(){if(this._cacheXDirty||this._cacheYDirty)return!0;let t=this._cachedX,e=this._cachedY;return this._cachedX=this._calculateOffsetX(),this._cachedY=this._calculateOffsetY(),t!==this._cachedX||e!==this._cachedY}destroy(){for(let t=0,e=this._translations.length;t<e;t++)this._translations[t].destroy()}_onChange(){this.transform&&this.transform.recalculate()}_calculateOffsetX(){let t=0;for(let e=0;e<this._translations.length;e++)this.transform&&(t+=this._translations[e].getOffsetXTopLeft(this.transform.bounds));return this.transform&&this.transform.parent&&this.transform.parent.hasPosition()&&(t+=this.transform.parent.position.x()),t}_calculateOffsetY(){let t=0;for(let e=0;e<this._translations.length;e++)this.transform&&(t+=this._translations[e].getOffsetYTopLeft(this.transform.bounds));return this.transform&&this.transform.parent&&this.transform.parent.hasPosition()&&(t+=this.transform.parent.position.y()),t}}class w{constructor(){this.tileSize=16,this.baseZoom=8,this.cameraX=0,this.cameraY=0,this.cameraScale=1,this.cameraSpeed=1e3,this.cameraTrauma=0,this.viewportWidth=1,this.viewportHeight=1,this.sidePadding=2}get worldScale(){return this.tileSize*this.baseZoom}}class v{constructor(){this.onCommandRecieved=new u}get commandFactory(){return this._commandFactory}set commandFactory(t){this._commandFactory=t}recieveCommand(t){this.onCommandRecieved.call(t)}}class y{constructor(t){this._invoker=t}recieveCommand(t){this._invoker.invoke(t)}}class D{constructor(){this._callbacks=new Map}invoke(t){let e=this._callbacks.get(t.commandType);e&&e.call(t)}push(t,e,s){let i=this._callbacks.get(t);i?i.push(e,s):(this._callbacks.set(t,new b),this._callbacks.get(t).push(e,s))}copy(t){let e=this._callbacks.get(t);return e?e.clone():null}unregister(t){let e=this._callbacks.values(),s=e.next();for(;!s.done;)s.value.unregister(t),s=e.next()}remove(t,e){let s=this._callbacks.get(t);s&&s.remove(e)}removeAll(t){let e=this._callbacks.get(t);e&&e.removeAll()}clear(){this._callbacks.clear()}}class b extends u{call(t){super.call(t)}push(t,e){return super.push(t,e)}}var x,S,W;!function(t){t[t.AgentMoveNorth=0]="AgentMoveNorth",t[t.AgentMoveSouth=1]="AgentMoveSouth",t[t.AgentMoveEast=2]="AgentMoveEast",t[t.AgentMoveWest=3]="AgentMoveWest",t[t.SpawnProjectile=4]="SpawnProjectile"}(x||(x={})),function(t){t[t.Update=0]="Update",t[t.CameraMove=1]="CameraMove",t[t.AgentMove=2]="AgentMove",t[t.TargetMove=3]="TargetMove",t[t.ActionStart=4]="ActionStart",t[t.ActionStop=5]="ActionStop",t[t.ZoomIn=6]="ZoomIn",t[t.ZoomOut=7]="ZoomOut"}(S||(S={}));class E{constructor(t,e,s){this._deltaSeconds=0,this._activeAgent=0,this._localData=e,this._connection=s,this._data=t,e.playing&&(this._lastPlayerHealth=t.teams[t.teams.length-1].agents[0].health)}create(t){t.push(S.AgentMove,this._agentMove.bind(this),this),t.push(S.TargetMove,this._targetMove.bind(this),this),t.push(S.CameraMove,this._cameraMoveCommand.bind(this),this),t.push(S.Update,this._update.bind(this),this),t.push(S.ZoomIn,this._cameraZoom.bind(this),this),t.push(S.ZoomOut,this._cameraZoom.bind(this),this),t.push(S.ActionStart,this._action.bind(this),this),t.push(S.ActionStop,this._action.bind(this),this)}_update(t){this._deltaSeconds=t.arg,this._updateCamera()}_updateCamera(){let t=0,e=0,s=!1,i=!1,n=this._localData.cameraX+this._localData.viewportWidth*this._localData.cameraScale;this._localData.cameraX<0&&n>this._localData.worldScale*this._data.map[0].length?s=!0:this._localData.cameraX<0?t+=-this._localData.cameraX:n>this._localData.worldScale*this._data.map[0].length&&(t+=this._localData.worldScale*this._data.map[0].length-n);let r=this._localData.cameraY+this._localData.viewportHeight*this._localData.cameraScale;if(this._localData.cameraY<0&&r>this._localData.worldScale*this._data.map[0][0].length?i=!0:this._localData.cameraY<0?e+=-this._localData.cameraY:r>this._localData.worldScale*this._data.map[0][0].length&&(e+=this._localData.worldScale*this._data.map[0][0].length-r),this._cameraMove(t/100*this._localData.sidePadding,e/100*this._localData.sidePadding),this._localData.playing){let n=0,r=0,a=this._data.teams[this._data.teams.length-1].agents[0];if(a.y!==1/0){let o=this._localData.cameraX+.5*this._localData.viewportWidth*this._localData.cameraScale;a.x*this._localData.worldScale!==o&&(n+=.008*(a.x*this._localData.worldScale-o));let h=this._localData.cameraY+.5*this._localData.viewportHeight*this._localData.cameraScale;a.y*this._localData.worldScale!==h&&(r+=.008*(a.y*this._localData.worldScale-h)),t>0&&(n=Math.max(n,0)),t<0&&(n=Math.min(n,0)),e>0&&(r=Math.max(r,0)),e<0&&(r=Math.min(r,0)),this._cameraMove(s?0:n,i?0:r)}}if(this._localData.cameraTrauma=Math.max(0,this._localData.cameraTrauma-this._deltaSeconds),this._localData.playing){let t=this._data.teams[this._data.teams.length-1].agents[0].health-this._lastPlayerHealth;this._lastPlayerHealth+=t,t<0&&(this._localData.cameraTrauma+=t)}}_targetMove(t){this._targetX=t.arg1-this._localData.cameraX,this._targetY=t.arg2-this._localData.cameraY}_action(t){}_agentMove(t){let e=t.arg1,s=t.arg2;if(-1===s){let t=this._connection.commandFactory.getCommand(x.AgentMoveNorth);t.agentID=this._activeAgent,this._connection.recieveCommand(t)}else if(1===s){let t=this._connection.commandFactory.getCommand(x.AgentMoveSouth);t.agentID=this._activeAgent,this._connection.recieveCommand(t)}if(-1===e){let t=this._connection.commandFactory.getCommand(x.AgentMoveWest);t.agentID=this._activeAgent,this._connection.recieveCommand(t)}else if(1===e){let t=this._connection.commandFactory.getCommand(x.AgentMoveEast);t.agentID=this._activeAgent,this._connection.recieveCommand(t)}}_cameraMoveCommand(t){this._cameraMove(4*t.arg1,4*t.arg2)}_cameraMove(t,e){let s=t*this._deltaSeconds*this._localData.cameraSpeed*this._localData.cameraScale,i=e*this._deltaSeconds*this._localData.cameraSpeed*this._localData.cameraScale;this._localData.cameraX+=s,this._localData.cameraY+=i}_cameraZoom(t){let e=this._localData.cameraScale;t.commandType===S.ZoomIn?this._localData.cameraScale=Math.max(this._localData.cameraScale-10*this._deltaSeconds,1):t.commandType===S.ZoomOut&&(this._localData.cameraScale=Math.min(this._localData.cameraScale+10*this._deltaSeconds,4)),this._localData.cameraX+=.5*(this._localData.viewportWidth*e-this._localData.viewportWidth*this._localData.cameraScale),this._localData.cameraY+=.5*(this._localData.viewportHeight*e-this._localData.viewportHeight*this._localData.cameraScale)}}class F{constructor(t,e){if(this._alwaysCheckForUpdates=!1,this._position=t,this._bounds=e,this.position&&(this._position.transform=this),this.bounds&&(this._bounds.transform=this),!this.bounds&&this.position)throw new Error("A Transform with a non-null Position must have a non-null Bounds")}get gameObject(){return this._gameObject}set gameObject(t){this._gameObject=t}get position(){return this._position}get bounds(){return this._bounds}get alwaysCheckForUpdates(){return this._alwaysCheckForUpdates}set alwaysCheckForUpdates(t){this._alwaysCheckForUpdates=t}get positioningDirty(){return this._positioningDirty}positioningIsDirty(){this._positioningDirty=!0}get parent(){return this.gameObject&&this.gameObject.parent?this.gameObject.parent.transform:null}hasPosition(){return null!==this.position}update(){(this._positioningDirty||this._alwaysCheckForUpdates)&&this._checkForUpdatedTranslationsOrDimensions()}_checkForUpdatedTranslationsOrDimensions(){this.position&&this.position.checkForUpdatedTranslations(),this.bounds&&this.bounds.checkForUpdatedDimensions(),this._positioningDirty=!1}recalculate(t){if(this._position&&this._position.setCacheDirty(),this._bounds&&(this._bounds.dirty=!0),0===this.gameObject.children.length)t||this.gameObject.requestDraw();else for(let e=0,s=this.gameObject.children.length;e<s;e++)this.gameObject.children[e].transform&&this.gameObject.children[e].transform.recalculate(t)}containsPoint(t,e){let s=this.position.x(),i=this.position.y();return t>=s&&e>=i&&t<=s+this.bounds.width()&&e<=i+this.bounds.height()}destroy(){this.bounds&&this.bounds.destroy(),this.position&&this.position.destroy()}static overlaps(t,e){let s=0,i=0,n=0,r=0;t.position&&(s=t.position.x(),i=t.position.y()),e.position&&(n=e.position.x(),r=e.position.y());let a=!1,o=!1;return s>=n&&s<=n+e.bounds.width()&&(a=!0),s<=n&&s+t.bounds.width()>=n&&(a=!0),i>=r&&i<=r+e.bounds.height()&&(o=!0),i<=r&&i+t.bounds.height()>=r&&(o=!0),a&&o}static contains(t,e){let s=t.position.x(),i=t.position.y(),n=e.position.x(),r=e.position.y(),a=!1,o=!1;return n>=s&&n+e.bounds.width()<=s+t.bounds.width()&&(a=!0),r>=i&&r+e.bounds.width()<=i+t.bounds.height()&&(o=!0),a&&o}}function T(t,e){C(t,e,t.length-1),t.length=t.length-1}function C(t,e,s){var i=t[e];t[e]=t[s],t[s]=i}class k{constructor(t,e){this.typeName="GameObject",this._children=[],this._assets=[],this._parent=null,this._created=!1,this._runLoad=!1,this._active=!0,this._interactable=!0,this._ranBegin=!1,this._visible=!0,this._opacity=1,this._cullIfOutOfBounds=!1,this._precreate=!1,this._transform=t instanceof f?new F(t,e):t,this._transform&&(this._transform.gameObject=this)}get parent(){return this._parent}set parent(t){this._parent=t}get transform(){return this._transform}get loaded(){if(!this.runLoad)return!1;let t=!0;for(let e=0,s=this._assets.length;e<s;e++)if(!this._assets[e].loaded){t=!1;break}return t}get subtreeLoaded(){if(!this.loaded)return!1;let t=!0;for(let e=0,s=this._children.length;e<s;e++)if(!this._children[e].subtreeLoaded){t=!1;break}return t}get runLoad(){return this._runLoad}get created(){return this._created}get assets(){return this._assets}get children(){return this._children}set active(t){this._active=t}get active(){return this._active}set interactable(t){this._interactable=t}get interactable(){return!!this._interactable&&(!this.parent||this.parent.interactable)}set visible(t){this._visible!==t&&(t||this.requestDraw(),this._visible=t,t&&this.requestDraw())}get visible(){return this._visible}get opacity(){return this._opacity}set opacity(t){this._opacity=t}get precreate(){return this._precreate}set precreate(t){this._precreate=t}get cullIfOutOfBounds(){return this._cullIfOutOfBounds}set cullIfOutOfBounds(t){this._cullIfOutOfBounds=t}addChild(t){if(t.parent)throw new Error("Adding child to GameObject, but child already has parent! GameObjects must not appear more than once in the GameObject tree. If you want to move a GameObject, first de-parent it.");return t.parent=this,this._children.push(t),t}getAsset(t){for(let e=0,s=this._assets.length;e<s;e++)if(this._assets[e].filename===t)return this.assets[e].asset;throw new Error("No asset found with that name on GameObject")}doLoad(t){this._runLoad||(this._runLoad=this.load(t));for(let e=0,s=this._children.length;e<s;e++)this._children[e].doLoad(t)}load(t){return!0}addAsset(t){if(null===t)return null;let e=!1;for(let s=0,i=this.assets.length;s<i;s++)this._assets[s].filename===t.filename&&(e=!0);return e?null:(this.assets.push(t),t)}doCreate(t,e,s,i){if(this._runLoad||this.doLoad(e),this.loaded){let n=!1;this.created||(n=!0,this.create(t,s,i));for(let n=0,r=this._children.length;n<r;n++)this._children[n].doCreate(t,e,s,i);this._created=!0,n&&this.afterCreate(),this.requestDraw()}}create(t,e,s){}afterCreate(){}doBegin(t,e,s,i){this._active?this._created?this._runBegin(t,e,s,i):(this.doCreate(t,e,s,i),this._created&&this._runBegin(t,e,s,i)):this._precreate&&!this._created&&this.doCreate(t,e,s,i)}_runBegin(t,e,s,i){this._ranBegin=!0;for(let n=this._children.length-1;n>=0;n--)this._children[n]&&this._children[n].doBegin(t,e,s,i);this.begin(t,s,i)}begin(t,e,s){}doUpdate(t){if(this._transform&&this._transform.update(),this._ranBegin){for(let e=this._children.length-1;e>=0;e--)this._children[e]&&this._children[e].doUpdate(t);this.update(t)}}update(t){}doDraw(t){if(this._created&&this._visible&&this._transform&&this._opacity>0&&this._transform.hasPosition()){let e=!1;if(this._transform.position.rotation%2*Math.PI!=0){e=!0;let s=this._transform.position.anchorX(.5)-t.x(),i=this._transform.position.anchorY(.5)-t.y();t.context2D.save(),t.context2D.translate(s,i),t.context2D.rotate(this._transform.position.rotation),t.context2D.translate(-s,-i)}let s=0;t.context2D&&(s=this._setDrawingOpacity(t.context2D)),this.draw(t);for(let e=0,s=this._children.length;e<s;e++)this._children[e].doDraw(t);t.context2D&&void 0!==s&&(t.context2D.globalAlpha=s),e&&t.context2D.restore()}}_setDrawingOpacity(t){if(1!==this._opacity){let e=t.globalAlpha;return t.globalAlpha=t.globalAlpha*this._opacity,e}}draw(t){}doEnd(t){if(this._ranBegin){for(let e=this._children.length-1;e>=0;e--)this._children[e]&&this._children[e].doEnd(t);this._ranBegin=!1,this.end(t)}}requestDraw(t){!this._visible||!this._parent||this._cullIfOutOfBounds&&this.isDrawCulled()||this._parent.requestDraw(!0)}isDrawCulled(){return!!(this._transform&&this._parent&&this._parent.created&&this._parent.transform)&&!F.overlaps(this._transform,this._parent.transform)}requestRemoval(){this._parent.removeChild(this)}removeChild(t){this.deparent(t),t.doDestroy()}deparent(t){let e=this._children.indexOf(t);-1!==e&&T(this._children,e)}doDestroy(){for(let t=0,e=this._children.length;t<e;t++)this._children[t].doDestroy();this._transform&&this._transform.destroy(),this.created&&this.destroy()}end(t){}destroy(){}}class R{constructor(){this.inBounds=!1,this.clickStarted=!1,this.toDestroy=!1}}class P extends k{constructor(t,e){super(t,e),this.typeName="MouseTrigger",this._pointerData=[],this._onlyIfUnhandled=!1}get onlyIfUnhandled(){return this._onlyIfUnhandled}set onlyIfUnhandled(t){this._onlyIfUnhandled=t}create(t,e,s){for(;this._pointerData.length<s.mouse.maxPointers;)this._pointerData.push(new R)}begin(t,e,s){this.interactable&&this.checkMouseActions(s.mouse)}checkMouseActions(t){t.wheelEvent&&this.onWheel(t);for(let t=0,e=this._pointerData.length;t<e;t++)this._pointerData[t].toDestroy=!0;for(let e=0,s=t.pointers.length;e<s;e++)if(e<t.maxPointers&&(!this.onlyIfUnhandled||!t.pointers[e].handled)){let s=this._pointerData[e],i=t.pointers[e];s.toDestroy=!1,this.transform.containsPoint(i.x,i.y)?(s.inBounds||this.onMouseEnter(t,i),s.inBounds=!0,this.onMouseHover(t,i),i.isStartEvent&&(s.clickStarted=!0,this.onMouseDown(t,i)),i.isMoveEvent&&(this.onMouseMove(t,i),i.isDown&&this.onMouseDrag(t,i)),i.isEndEvent&&(this.onMouseUp(t,i),s.inBounds=!1,s.clickStarted&&(this.onMouseClick(t,i),s.clickStarted=!1))):(s.inBounds&&(this.onMouseLeave(t,i),s.inBounds=!1),s.clickStarted&&i.isEndEvent&&(s.clickStarted=!1))}for(let e=0,s=this._pointerData.length;e<s;e++)this._pointerData[e].toDestroy&&this._pointerData[e].inBounds&&(this.onMouseLeave(t,null),this._pointerData[e].inBounds=!1)}onMouseHover(t,e){}onMouseMove(t,e){}onMouseDown(t,e){}onMouseUp(t,e){}onMouseDrag(t,e){}onMouseLeave(t,e){}onMouseEnter(t,e){}onMouseClick(t,e){}onWheel(t){}}class M{constructor(t){this._commandType=t}get commandType(){return this._commandType}set commandType(t){this._commandType=t}}class A extends M{constructor(t,e){super(t),this._arg=e}get arg(){return this._arg}set arg(t){this._arg=t}}class U extends M{constructor(t,e,s){super(t),this._arg1=e,this._arg2=s}get arg1(){return this._arg1}set arg1(t){this._arg1=t}get arg2(){return this._arg2}set arg2(t){this._arg2=t}}class O extends P{constructor(t,e,s){super(t,e),this._controller=s,this._command0=new M(S.ActionStop),this._command2=new U(S.TargetMove,0,0)}onMouseMove(t,e){this._command2.arg1=e.x-this.transform.position.x(),this._command2.arg2=e.y-this.transform.position.y(),this._command2.commandType=S.TargetMove,this._controller.recieveCommand(this._command2)}onMouseDown(t,e){this._command0.commandType=S.ActionStart,this._controller.recieveCommand(this._command0)}onMouseUp(t,e){this._command0.commandType=S.ActionStop,this._controller.recieveCommand(this._command0)}onMouseLeave(t,e){this._command0.commandType=S.ActionStop,this._controller.recieveCommand(this._command0)}onWheel(t){t.wheelY>0?(this._command0.commandType=S.ZoomOut,this._controller.recieveCommand(this._command0)):t.wheelY<0&&(this._command0.commandType=S.ZoomIn,this._controller.recieveCommand(this._command0))}}!function(t){t[t.onKeyPress=0]="onKeyPress",t[t.onKeyNewDown=1]="onKeyNewDown",t[t.onKeyIsDown=2]="onKeyIsDown",t[t.onKeyUp=3]="onKeyUp"}(W||(W={}));class B extends k{constructor(){super(null,null),this.typeName="KeyTrigger",this._keys=[],this._newKeysDown=[]}getKeyEvent(t,e){void 0===e&&(e=W.onKeyIsDown);for(let s=0,i=this._keys.length;s<i;s++)if(this._keys[s].keycode===t&&this._keys[s].trigger===e)return this._keys[s].event;let s=new c;return this._keys.push({keycode:t,trigger:e,event:s}),s}removeKeyEvent(t,e){let s=this._keys.filter(s=>s.keycode===t&&s.trigger===e);if(s.length>0){for(let t=0;t<s.length;t++)T(this._keys,this._keys.indexOf(s[t]));return!0}return!1}begin(t,e,s){if(this.interactable)for(let t=0,e=this._keys.length;t<e;t++)this._keys[t].trigger===W.onKeyUp?s.keyboard.isKeyUp(this._keys[t].keycode)&&this._keys[t].event.call():this._keys[t].trigger===W.onKeyIsDown?s.keyboard.isKeyDown(this._keys[t].keycode)&&this._keys[t].event.call():this._keys[t].trigger===W.onKeyPress?s.keyboard.isKeyPressed(this._keys[t].keycode)&&this._keys[t].event.call():this._keys[t].trigger===W.onKeyNewDown&&(s.keyboard.isKeyDown(this._keys[t].keycode)?-1===this._newKeysDown.indexOf(this._keys[t].keycode)&&(this._newKeysDown.push(this._keys[t].keycode),this._keys[t].event.call()):-1!==this._newKeysDown.indexOf(this._keys[t].keycode)&&T(this._newKeysDown,this._keys[t].keycode))}}class L extends k{constructor(t){super(null,null),this._command0=new M(S.ActionStop),this._command2=new U(S.ActionStop,0,0),this._controller=t,this._moveCommandUp=this._moveCommand.bind(this,0,-1),this._moveCommandDown=this._moveCommand.bind(this,0,1),this._moveCommandLeft=this._moveCommand.bind(this,-1,0),this._moveCommandRight=this._moveCommand.bind(this,1,0),this._moveCameraCommandUp=this._moveCameraCommand.bind(this,0,-1),this._moveCameraCommandDown=this._moveCameraCommand.bind(this,0,1),this._moveCameraCommandLeft=this._moveCameraCommand.bind(this,-1,0),this._moveCameraCommandRight=this._moveCameraCommand.bind(this,1,0)}create(){this.addChild(this._createKeyTrigger())}_moveCameraCommand(t,e){this._command2.commandType=S.CameraMove,this._command2.arg1=t,this._command2.arg2=e,this._controller.recieveCommand(this._command2)}_moveCommand(t,e){this._command2.commandType=S.AgentMove,this._command2.arg1=t,this._command2.arg2=e,this._controller.recieveCommand(this._command2)}_actionStart(){this._command0.commandType=S.ActionStart,this._controller.recieveCommand(this._command0)}_actionStop(){this._command0.commandType=S.ActionStop,this._controller.recieveCommand(this._command0)}_createKeyTrigger(){let t=new B;return t.getKeyEvent("ArrowUp",W.onKeyIsDown).push(this._moveCameraCommandUp),t.getKeyEvent("ArrowDown",W.onKeyIsDown).push(this._moveCameraCommandDown),t.getKeyEvent("ArrowLeft",W.onKeyIsDown).push(this._moveCameraCommandLeft),t.getKeyEvent("ArrowRight",W.onKeyIsDown).push(this._moveCameraCommandRight),t.getKeyEvent("w",W.onKeyIsDown).push(this._moveCommandUp),t.getKeyEvent("s",W.onKeyIsDown).push(this._moveCommandDown),t.getKeyEvent("a",W.onKeyIsDown).push(this._moveCommandLeft),t.getKeyEvent("d",W.onKeyIsDown).push(this._moveCommandRight),t.getKeyEvent(" ",W.onKeyNewDown).push(this._actionStart.bind(this)),t.getKeyEvent(" ",W.onKeyUp).push(this._actionStop.bind(this)),t}}class N extends a{}class Y extends n{}class X extends k{constructor(t,e,s,i){super(t,e),this.typeName="BufferClone",this._origin=new Y(0,0),this._area=null,this._imageSmoothingEnabled=!0,this._cameraToDraw=s,this._clipFunction=i}get clipFunction(){return this._clipFunction}set clipFunction(t){this._clipFunction=t}get origin(){return this._origin}set origin(t){this._origin=t}get area(){return this._area}set area(t){this._area=t}get cameraToDraw(){return this._cameraToDraw}get imageSmoothingEnabled(){return this._imageSmoothingEnabled}set imageSmoothingEnabled(t){this._imageSmoothingEnabled=t}draw(t){let e=t.context2D.imageSmoothingEnabled;if(t.context2D.imageSmoothingEnabled=this.imageSmoothingEnabled,!this._cameraToDraw)throw new Error("Cannot draw bufferclone because the provided Camera is null");if(this._cameraToDraw.created){let e=this.transform.position.x()-t.x(),s=this.transform.position.y()-t.y();this._clipFunction&&(t.context2D.save(),this._clipFunction(t.context2D,e,s,this.transform.bounds.width(),this.transform.bounds.height()),t.context2D.clip());let i=this._cameraToDraw.canvasUsedWidth,n=this._cameraToDraw.canvasUsedHeight;this.area&&(i=this.area.pixelWidth(this.transform.bounds)*this._cameraToDraw.pixelRatio,n=this.area.pixelHeight(this.transform.bounds)*this._cameraToDraw.pixelRatio);let r=this.origin.getOffsetXTopLeft(this._cameraToDraw.transform.bounds),a=this.origin.getOffsetXTopLeft(this._cameraToDraw.transform.bounds);t.context2D.drawImage(this._cameraToDraw.canvas,r*this._cameraToDraw.pixelRatio,a*this._cameraToDraw.pixelRatio,i,n,e,s,this.transform.bounds.width(),this.transform.bounds.height()),this._clipFunction&&t.context2D.restore()}t.context2D.imageSmoothingEnabled=e}}class V{constructor(t,e,s,i,n,r){"string"==typeof t?(this.colour=t,this.size=e,this.fontFace=s,this.lineSpacing=i,this.targetWidth=n,this.centred=r):(this.colour=t.textColour,this.size=t.textSize,this.fontFace=t.fontFace,this.lineSpacing=t.lineSpacing,this.targetWidth=t.targetTextWidth,this.centred=t.textCentred)}}class I extends k{constructor(t,e,s,i,n,r,a,o,h){super(t,e),this._widths=[],this._lines=[],this._countLines=0,this._canvasFunction=null,this.typeName="Text",this._textStyle=i instanceof V?i:new V(i,n,r,a,o,h||!1),this._lines="string"==typeof s?[s]:s,this._fontLine=this.size+"pt "+this.fontFace}get color(){return this._textStyle.colour}get fontFace(){return this._textStyle.fontFace}get size(){return this._textStyle.size}get lineSpacing(){return this._textStyle.lineSpacing}get centred(){return this._textStyle.centred}set text(t){this._lines=t?t.split("\n"):[],this.requestDraw(),this._recalculateTextBounds=!0}get lines(){return this._lines}set lines(t){this._lines=t,this.requestDraw(),this._recalculateTextBounds=!0}get canvasFunction(){return this._canvasFunction}set canvasFunction(t){this._canvasFunction=t}measureTextForBounds(t){this.transform.bounds.clearDimensions();let e=new H(this.lines,t,this.color,this.size,this.fontFace,this.lineSpacing);this.transform.bounds.addDimension(e.textDimension()),this._recalculateTextBounds=!1}draw(t){this.canvasFunction&&(t.context2D.save(),this.canvasFunction(t.context2D)),t.context2D.fillStyle=this.color,t.context2D.font=this._fontLine,this._recalculateTextBounds&&this.measureTextForBounds(t.context2D);let e=this.transform.position.x()-t.x(),s=this.transform.position.y()-t.y(),i=0,n=0;for(let r=0;r<this._lines.length;r++)n=this.centred?(this._widest-this._widths[r])/2:0,t.context2D.fillText(this._lines[r],e+n,s+i+this.size),i+=this._textStyle.size*this.lineSpacing;this.canvasFunction&&t.context2D.restore()}}class H{constructor(t,e,s,i,n,r,a,o){this._lines=[],this._widths=[],this._countLines=0,this._lines="string"==typeof t?t.split("\n"):t,this._context2D=e,this._textStyle=s instanceof V?s:new V(s,i,n,r||1,a||void 0,o||!1)}get color(){return this._textStyle.colour}get fontFace(){return this._textStyle.fontFace}get size(){return this._textStyle.size}get lineSpacing(){return this._textStyle.lineSpacing}get textStyle(){return this._textStyle}set text(t){this._lines=t.split("\n")}get lines(){return this._lines}set lines(t){this._lines=t}buildText(t){let e=this.textDimension();return new I(t,new p(e),this.lines,this.textStyle)}textDimension(){let t=[];this._textStyle.targetWidth?(this._context2D.font=this.size+"pt "+this.fontFace,this.lines.forEach(e=>t=t.concat(this._getWrappedLines(this._context2D,e,this._textStyle.targetWidth)))):t=this.lines,this._context2D.font=this.size+"pt "+this.fontFace;let e=0,s=0,i=[];for(let n=0;n<t.length;n++)i[n]=this._context2D.measureText(t[n]).width,e=Math.max(e,i[n]),n===t.length-1?s+=this.size:s+=this.size*this.lineSpacing;return this.lines=t,new N(e,s)}_getWrappedLines(t,e,s){var i=e.split(" "),n="";let r=[];for(var a=0;a<i.length;a++){var o=n+i[a];t.measureText(o).width>s&&a>0?(r.push(n.trimRight()),n=i[a]+" "):n=o+" "}return r.push(n.trimRight()),r}}class K extends k{constructor(t,e,s,i,n){super(t,e),this.typeName="Shape",this._strokeStyle=void 0,this._fillStyle=void 0,this._lineWidth=void 0,this.strokeStyle=s,this.fillStyle=i,this.lineWidth=n}get strokeStyle(){return this._strokeStyle}get fillStyle(){return this._fillStyle}get lineWidth(){return this._lineWidth}set strokeStyle(t){this._strokeStyle=t}set lineWidth(t){this._lineWidth=t}set fillStyle(t){this._fillStyle=t}}class z extends K{constructor(t,e,s,i,n,r){super(t,e,s,i,n),this.typeName="RoundedRect",this._canvasFunction=null,this._radii=r instanceof Array?r:[r,r,r,r]}get canvasFunction(){return this._canvasFunction}set canvasFunction(t){this._canvasFunction=t}draw(t){this.canvasFunction&&(t.context2D.save(),this.canvasFunction(t.context2D)),t.context2D.strokeStyle=this.strokeStyle,t.context2D.lineWidth=this.lineWidth,t.context2D.fillStyle=this.fillStyle;let e=this.transform.position.x()-t.x(),s=this.transform.position.y()-t.y(),i=void 0!==this.fillStyle,n=void 0!==this.strokeStyle;this._roundRect(t.context2D,e,s,this.transform.bounds.width(),this.transform.bounds.height(),this._radii,i,n),this.canvasFunction&&t.context2D.restore()}_roundRect(t,e,s,i,n,r,a,o){t.beginPath(),t.moveTo(e+r[0],s),t.lineTo(e+i-r[1],s),t.quadraticCurveTo(e+i,s,e+i,s+r[1]),t.lineTo(e+i,s+n-r[2]),t.quadraticCurveTo(e+i,s+n,e+i-r[2],s+n),t.lineTo(e+r[3],s+n),t.quadraticCurveTo(e,s+n,e,s+n-r[3]),t.lineTo(e,s+r[0]),t.quadraticCurveTo(e,s,e+r[0],s),t.closePath(),a&&t.fill(),o&&t.stroke()}}class j extends K{constructor(){super(...arguments),this.typeName="Rect",this._canvasFunction=null}get canvasFunction(){return this._canvasFunction}set canvasFunction(t){this._canvasFunction=t}draw(t){this.canvasFunction&&(t.context2D.save(),this.canvasFunction(t.context2D));let e=this.transform.position.x()-t.x(),s=this.transform.position.y()-t.y();this.fillStyle&&this._filled(t.context2D,e,s,this.transform.bounds.width(),this.transform.bounds.height()),this.lineWidth>0&&this.strokeStyle&&this._outline(t.context2D,e,s,this.transform.bounds.width(),this.transform.bounds.height()),this.canvasFunction&&t.context2D.restore()}_outline(t,e,s,i,n){t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.beginPath(),t.rect(e+this.lineWidth/2,s+this.lineWidth/2,i-this.lineWidth,n-this.lineWidth),t.stroke()}_filled(t,e,s,i,n){t.fillStyle=this.fillStyle,t.beginPath(),t.fillRect(e,s,i,n)}}class q extends j{constructor(t,e,s){super(t,e,void 0,s,0)}}class G extends P{constructor(t,e){super(t,e),this.typeName="ClickTrigger",this.handleClicks=!1,this._firedThisUpdate=!1,this._onClick=new m}get onClick(){return this._onClick}suppressThisUpdate(){this._firedThisUpdate=!0}onMouseClick(t,e){this._firedThisUpdate||(this.onClick.call(t,e),this._firedThisUpdate=!0,this.handleClicks&&(e.handled=!0))}begin(t,e,s){this._firedThisUpdate=!1,super.begin(t,e,s)}}class Z extends G{constructor(t,e,s){super(t,e),this.typeName="Button",this._buttonReset=!1,this._pressed=!1,this._content=s,this.onlyIfUnhandled=!0,this.handleClicks=!0}get content(){return this._content}get hoverRect(){return this._hoverRect}get pressedRect(){return this._pressedRect}get backgroundRect(){return this._backgroundRect}get depressDistance(){return this._depressDistance}setDepressDistance(t){this._depressDistance=t,!this._depressTranslation&&this._depressDistance?(this._depressTranslation=new Y(this._pressed?this._depressDistance:new i(0,0)),this._content&&this._content.transform.position.addTranslation(this._depressTranslation),this._backgroundRect&&this._backgroundRect.transform.position.addTranslation(this._depressTranslation),this._hoverRect&&this._hoverRect.transform.position.addTranslation(this._depressTranslation),this._pressedRect&&this._pressedRect.transform.position.addTranslation(this._depressTranslation)):this._depressTranslation&&this._depressDistance&&this._pressed&&(this._depressTranslation.innerX=this._depressDistance.x,this._depressTranslation.innerY=this._depressDistance.y,this._content&&this._content.transform.recalculate(),this._backgroundRect&&this._backgroundRect.transform.recalculate(),this._hoverRect&&this._hoverRect.transform.recalculate(),this._pressedRect&&this._pressedRect.transform.recalculate())}setHoverRect(t){return this._hoverRect=t,this._hoverRect.visible=!1,this._depressTranslation&&this._hoverRect.transform.position.addTranslation(this._depressTranslation),t}setPressedRect(t){return this._pressedRect=t,this._pressedRect.visible=!1,this._depressTranslation&&this._pressedRect.transform.position.addTranslation(this._depressTranslation),t}setBackgroundRect(t){return this._backgroundRect=t,this._depressTranslation&&this._backgroundRect.transform.position.addTranslation(this._depressTranslation),t}reset(){this.hoverRect&&(this.hoverRect.visible=!1),this.pressedRect&&(this.pressedRect.visible=!1),this.requestDraw(),this._buttonReset=!0,this._pressed=!1,this._depressTranslation&&(this._depressTranslation.innerX=0,this._depressTranslation.innerY=0,this._content&&this._content.transform.recalculate(),this._backgroundRect&&this._backgroundRect.transform.recalculate(),this._hoverRect&&this._hoverRect.transform.recalculate(),this._pressedRect&&this._pressedRect.transform.recalculate())}create(t,e,s){super.create(t,e,s),this._content&&this.addChild(this._content)}onMouseClick(t,e){this._buttonReset||super.onMouseClick(t,e),e.handled=!0}onMouseMove(t,e){e.handled=!0}onMouseDown(t,e){this._buttonReset=!1,this._pressed=!0,this.pressedRect&&(this.pressedRect.visible=!0),this.hoverRect&&(this.hoverRect.visible=!1),this._depressTranslation&&(this._depressTranslation.innerX=this._depressDistance.x,this._depressTranslation.innerY=this._depressDistance.y,this._content&&this._content.transform.recalculate(),this._backgroundRect&&this._backgroundRect.transform.recalculate(),this._hoverRect&&this._hoverRect.transform.recalculate(),this._pressedRect&&this._pressedRect.transform.recalculate()),e.handled=!0}onMouseUp(t,e){this._depressTranslation&&(this._depressTranslation.innerX=0,this._depressTranslation.innerY=0,this._content&&this._content.transform.recalculate(),this._backgroundRect&&this._backgroundRect.transform.recalculate(),this._hoverRect&&this._hoverRect.transform.recalculate(),this._pressedRect&&this._pressedRect.transform.recalculate()),this.pressedRect&&(this.pressedRect.visible=!1),this.hoverRect&&(this.hoverRect.visible=!0),e.handled=!0}onMouseEnter(t,e){this.hoverRect&&(this.hoverRect.visible=!0),e.handled=!0}onMouseLeave(t,e){this._pressed=!1,this._depressTranslation&&(this._depressTranslation.innerX=0,this._depressTranslation.innerY=0,this._content&&this._content.transform.recalculate(),this._backgroundRect&&this._backgroundRect.transform.recalculate(),this._hoverRect&&this._hoverRect.transform.recalculate(),this._pressedRect&&this._pressedRect.transform.recalculate()),this.hoverRect&&(this.hoverRect.visible=!1),this.pressedRect&&(this.pressedRect.visible=!1)}}class J extends P{constructor(){super(...arguments),this.typeName="AsyncClickTrigger",this.onClick=new c}create(t,e,s){super.create(t,e,s),this._clickAsyncEvent=s.mouse.onClickAsync,s.mouse.onClickAsync.push(this._asyncClick.bind(this),this)}_asyncClick(t,e){this._pointerData[e.id].clickStarted&&this.transform.containsPoint(e.x,e.y)&&this.active&&this.onClick.call()}destroy(){this._clickAsyncEvent.unregister(this)}}class Q extends J{constructor(t,e,s){super(t,e),this.typeName="AsyncButton",this._buttonReset=!1,this._pressed=!1,this._content=s,this.onlyIfUnhandled=!0}get content(){return this._content}get hoverRect(){return this._hoverRect}get pressedRect(){return this._pressedRect}get backgroundRect(){return this._backgroundRect}get depressDistance(){return this._depressDistance}setDepressDistance(t){this._depressDistance=t,!this._depressTranslation&&this._depressDistance?(this._depressTranslation=new Y(this._pressed?this._depressDistance:new i(0,0)),this._content&&this._content.transform.position.addTranslation(this._depressTranslation),this._backgroundRect&&this._backgroundRect.transform.position.addTranslation(this._depressTranslation),this._hoverRect&&this._hoverRect.transform.position.addTranslation(this._depressTranslation),this._pressedRect&&this._pressedRect.transform.position.addTranslation(this._depressTranslation)):this._depressTranslation&&this._depressDistance&&this._pressed&&(this._depressTranslation.innerX=this._depressDistance.x,this._depressTranslation.innerY=this._depressDistance.y,this._content&&this._content.transform.recalculate(),this._backgroundRect&&this._backgroundRect.transform.recalculate(),this._hoverRect&&this._hoverRect.transform.recalculate(),this._pressedRect&&this._pressedRect.transform.recalculate())}setHoverRect(t){return this._hoverRect=t,this._hoverRect.visible=!1,this._depressTranslation&&this._hoverRect.transform.position.addTranslation(this._depressTranslation),t}setPressedRect(t){return this._pressedRect=t,this._pressedRect.visible=!1,this._depressTranslation&&this._pressedRect.transform.position.addTranslation(this._depressTranslation),t}setBackgroundRect(t){return this._backgroundRect=t,this._depressTranslation&&this._backgroundRect.transform.position.addTranslation(this._depressTranslation),t}reset(){this.hoverRect&&(this.hoverRect.visible=!1),this.pressedRect&&(this.pressedRect.visible=!1),this.requestDraw(),this._buttonReset=!0,this._pressed=!1,this._depressTranslation&&(this._depressTranslation.innerX=0,this._depressTranslation.innerY=0,this._content&&this._content.transform.recalculate(),this._backgroundRect&&this._backgroundRect.transform.recalculate(),this._hoverRect&&this._hoverRect.transform.recalculate(),this._pressedRect&&this._pressedRect.transform.recalculate())}create(t,e,s){super.create(t,e,s),this._content&&this.addChild(this._content)}onMouseClick(t,e){this._buttonReset||super.onMouseClick(t,e),e.handled=!0}onMouseMove(t,e){e.handled=!0}onMouseDown(t,e){this._buttonReset=!1,this._pressed=!0,this.pressedRect&&(this.pressedRect.visible=!0),this.hoverRect&&(this.hoverRect.visible=!1),this._depressTranslation&&(this._depressTranslation.innerX=this._depressDistance.x,this._depressTranslation.innerY=this._depressDistance.y,this._content&&this._content.transform.recalculate(),this._backgroundRect&&this._backgroundRect.transform.recalculate(),this._hoverRect&&this._hoverRect.transform.recalculate(),this._pressedRect&&this._pressedRect.transform.recalculate()),e.handled}onMouseUp(t,e){this._depressTranslation&&(this._depressTranslation.innerX=0,this._depressTranslation.innerY=0,this._content&&this._content.transform.recalculate(),this._backgroundRect&&this._backgroundRect.transform.recalculate(),this._hoverRect&&this._hoverRect.transform.recalculate(),this._pressedRect&&this._pressedRect.transform.recalculate()),this.pressedRect&&(this.pressedRect.visible=!1),this.hoverRect&&(this.hoverRect.visible=!0),e.handled}onMouseEnter(t,e){this.hoverRect&&(this.hoverRect.visible=!0),e.handled}onMouseLeave(t,e){this._pressed=!1,this._depressTranslation&&(this._depressTranslation.innerX=0,this._depressTranslation.innerY=0,this._content&&this._content.transform.recalculate(),this._backgroundRect&&this._backgroundRect.transform.recalculate(),this._hoverRect&&this._hoverRect.transform.recalculate(),this._pressedRect&&this._pressedRect.transform.recalculate()),this.hoverRect&&(this.hoverRect.visible=!1),this.pressedRect&&(this.pressedRect.visible=!1)}}class ${static createText(t,e,s,i,n){let r,a;return r=i instanceof V?i:new V(i),a=s,void 0!==n&&(r.targetWidth=n),new H(a,e,r).buildText(t instanceof f?t:new f)}static createRect(t,e,s){let i=s.rounding;return i>0?new z(t,e,s.strokeColour,s.backgroundColour,s.strokeWidth,i):new j(t,e,s.strokeColour,s.backgroundColour,s.strokeWidth)}static createButton(t,e,s,i){let n=new Z(t,e,s);return n.setBackgroundRect(n.addChild($.createRect(new f,p.fill,i))),n.setHoverRect(n.addChild($.createRect(new f,p.fill,i.hover))),n.setPressedRect(n.addChild($.createRect(new f,p.fill,i.pressed))),n.setDepressDistance(i.depressDistance),n}static createFullscreenButton(t,e,s,i,n){let r=new Q(t,e,s);return r.setBackgroundRect(r.addChild($.createRect(new f,p.fill,i))),r.setHoverRect(r.addChild($.createRect(new f,p.fill,i.hover))),r.setPressedRect(r.addChild($.createRect(new f,p.fill,i.pressed))),r.setDepressDistance(i.depressDistance),r.onClick.push(()=>{n.isFullscreen?document.exitFullscreen():n.requestFullscreen()},null),r}}class tt extends k{constructor(t,e){super(t,e),this._canvas=null,this._context2D=null,this._hasAlphaChannel=!0,this._imageSmoothingEnabled=!0,this.debugDisableCache=!1,this.transform.hasPosition()&&(this.x=this.transform.position.x.bind(this.transform.position),this.y=this.transform.position.y.bind(this.transform.position))}x(){return 0}y(){return 0}get context2D(){return this._context2D}get container(){return this._container}set container(t){this._container=t}get canvas(){return this._canvas}get canvasUsedWidth(){return Math.ceil(this.transform.bounds.width()*this.pixelRatio)}get canvasUsedHeight(){return Math.ceil(this.transform.bounds.height()*this.pixelRatio)}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){this._backgroundColor=t}get pixelRatio(){return this._pixelRatio}get hasAlphaChannel(){return this._hasAlphaChannel}set hasAlphaChannel(t){this._hasAlphaChannel!==t&&this._canvas&&(this._context2D=this._canvas.getContext("2d",{alpha:t})),this._hasAlphaChannel=t}get imageSmoothingEnabled(){return this._imageSmoothingEnabled}set imageSmoothingEnabled(t){this._imageSmoothingEnabled=t,this._context2D&&(this._context2D.imageSmoothingEnabled=t)}clear(){this.backgroundColor?(this._context2D.fillStyle=this.backgroundColor,this._context2D.fillRect(0,0,this._canvas.width/this.pixelRatio,this._canvas.height/this.pixelRatio)):this._context2D.clearRect(0,0,this.canvas.width/this.pixelRatio,this.canvas.height/this.pixelRatio)}create(t,e,s){this._createDrawBuffer(e),this._container&&e.addCanvasToPage(this.canvas,this._container),$.context2D||($.context2D=this.context2D)}begin(t,e,s){this._container&&(s.mouse&&(s.mouse.htmlElementForOffset=this._canvas),e.activeContainer=this._container),this._hasResized()||this._pixelRatio!==e.devicePixelRatio?(this._resizeCanvas(this.transform.bounds.width(),this.transform.bounds.height(),e.devicePixelRatio),this.requestDraw()):this.debugDisableCache&&this.requestDraw()}_createDrawBuffer(t){this._canvas=t.createCanvas(),this._context2D=this._canvas.getContext("2d",{alpha:this.hasAlphaChannel}),this._resizeCanvas(this.transform.bounds.width(),this.transform.bounds.height(),t.devicePixelRatio),this.clear()}_resizeCanvas(t,e,s){this._pixelRatio=s,t=Math.round(t),e=Math.round(e),this.canvas.width=Math.max(t*this.pixelRatio,tt.minCanvasSize),this.canvas.height=Math.max(e*this.pixelRatio,tt.minCanvasSize),this.canvas.style.width=Math.max(this.transform.bounds.width(),tt.minCanvasSize/this.pixelRatio)+"px",this.canvas.style.height=Math.max(this.transform.bounds.height(),tt.minCanvasSize/this.pixelRatio)+"px",this._oldDimensionX=t,this._oldDimensionY=e,this._context2D.setTransform(1,0,0,1,0,0),this._context2D.scale(this.pixelRatio,this.pixelRatio),this._context2D.imageSmoothingEnabled=this._imageSmoothingEnabled}_hasResized(){return this._oldDimensionX!==Math.round(this.transform.bounds.width())||this._oldDimensionY!==Math.round(this.transform.bounds.height())}}tt.minCanvasSize=256;class et extends k{constructor(t,e,s){super(new st(t,e)),this.typeName="DrawBuffer",this._drawRequested=!1,this._forgetInternalsOnDraw=!1,this._canvasDrawFixed=!1,this._cameras=[],this.transform.position&&(this.transform.position.resetDrawPos=!0),!1!==s&&this.addCamera(this.addChild(new tt(new f,p.fill)))}get forgetInternalsOnDraw(){return this._forgetInternalsOnDraw}set forgetInternalsOnDraw(t){this._forgetInternalsOnDraw=t}get drawRequested(){return this._drawRequested}get cameras(){return this._cameras}get mainCamera(){return this._mainCamera}set mainCamera(t){this._mainCamera=t}doDraw(t){if(this.created){if(this._drawRequested&&!this._canvasDrawFixed){this._drawRequested=!1;for(let t=0,e=this._cameras.length;t<e;t++)this._cameras[t].visible&&this._cameras[t].created&&this._drawCamera(this._cameras[t]);if(this._forgetInternalsOnDraw){for(let t=0,e=this.children.length;t<e;t++)this.removeChild(this.children[t]);this._canvasDrawFixed=!0}}this.draw(t)}}requestDraw(t){this._drawRequested=!0,super.requestDraw(t)}addCamera(t){return this._cameras.push(t),1===this._cameras.length&&(this._mainCamera=t),t}draw(t){if(t&&this.transform.position&&this.visible&&this.mainCamera){let e=void 0;if(1!==this.opacity){let e=t.context2D.globalAlpha;t.context2D.globalAlpha=e*this.opacity}this.transform.position.resetDrawPos=!1;let s=this.transform.position.x()-t.x(),i=this.transform.position.y()-t.y(),n=this.transform.bounds.width(),r=this.transform.bounds.height();this.transform.position.resetDrawPos=!0,t.context2D.drawImage(this.mainCamera.canvas,0,0,Math.round(n)*this.mainCamera.pixelRatio,Math.round(r)*this.mainCamera.pixelRatio,Math.round(s),Math.round(i),Math.round(n),Math.round(r)),e&&(t.context2D.globalAlpha=e)}}_drawCamera(t){t.context2D.globalAlpha=1,t.clear();for(let e=0,s=this.children.length;e<s;e++)this.children[e].doDraw(t)}}class st extends F{recalculate(t){t||this.bounds.hasResizedAutoUpdate()||(t=!0,super.gameObject.requestDraw()),super.recalculate(t)}}class it extends tt{constructor(t,e,s,i){super(t,e),this._offsetX=0,this._offsetY=0,this._localData=i,this._pos=t.addTranslation(new Y(0,0)),this._dim=s}begin(t,e,s){super.begin(t,e,s),this._move(this._localData.cameraX,this._localData.cameraY,t.deltaSeconds),this._scale(this._localData.cameraScale,this._localData.cameraScale),this._pos.innerX-=this._offsetX,this._pos.innerY-=this._offsetY,this._offsetX=Math.random()*this._localData.cameraTrauma*10,this._offsetY=Math.random()*this._localData.cameraTrauma*10,this._pos.innerX+=this._offsetX,this._pos.innerY+=this._offsetY}_move(t,e,s){let i=t-this._pos.innerX,n=e-this._pos.innerY;this._pos.innerX+=.1*i,this._pos.innerY+=.1*n,0===i&&0===n||this.transform.positioningIsDirty()}_scale(t,e){let s=e-this._dim.height,i=t-this._dim.width;this._dim.height+=.1*s,this._dim.width+=.1*i,0===i&&0===s||this.transform.positioningIsDirty()}}var nt,rt,at=s(1),ot=s.n(at);class ht{constructor(t,e,s){this._emptySprites=[],this._sheet=t,this._tileHeight=s,this._tileWidth=e,this._width=Math.ceil(t.naturalWidth/this._tileWidth)}get tileWidth(){return this._tileWidth}get tileHeight(){return this._tileHeight}setEmptySprite(...t){this._emptySprites=this._emptySprites.concat(t)}getTileX(t){return t%this._width}getTileY(t){return Math.floor(t/this._width)}draw(t,e,s,i,n,r){t.drawImage(this._sheet,this.getTileX(i)*this._tileWidth,this.getTileY(i)*this._tileHeight,this._tileWidth,this._tileHeight,e,s,n||this._tileWidth,r||this._tileHeight)}isEmpty(t){return-1!==this._emptySprites.indexOf(t)}}class lt extends k{constructor(t,e,s,i){super(t,e),this._tileMap=s,this._spriteSheet=i}draw(t){for(let e=0,s=this._tileMap.length;e<s;e++)for(let s=0,i=this._tileMap[e].length;s<i;s++)if(!this._spriteSheet.isEmpty(this._tileMap[e][s])){let i=this.transform.position.x()-t.x(),n=this.transform.position.y()-t.y(),r=Math.round(e*this._spriteSheet.tileWidth+i),a=Math.round(s*this._spriteSheet.tileHeight+n);this._spriteSheet.draw(t.context2D,r,a,this._tileMap[e][s])}}}function dt(t,e){let s=e>=0?t[e]:null,i=function(){let t=new Map;return t.set(rt.Floor,[22,23,24,43,44,45,64,65,66]),t.set(rt.WallUpper,[81]),t.set(rt.WallLower,[80]),t.set(rt.FloorEdgeN,[1,2,3]),t.set(rt.FloorEdgeS,[85,86,87]),t.set(rt.FloorEdgeE,[25,46,67]),t.set(rt.FloorEdgeW,[21,42,63]),t.set(rt.FloorEdgeNW,[0]),t.set(rt.FloorEdgeNE,[4]),t.set(rt.FloorEdgeSW,[84]),t.set(rt.FloorEdgeSE,[88]),t.set(rt.FloorCornerSE,[30]),t.set(rt.FloorCornerSW,[31]),t.set(rt.FloorCornerNE,[51]),t.set(rt.FloorCornerNW,[52]),t.set(rt.FloorPathV,[26,28]),t.set(rt.FloorPathH,[6,48]),t.set(rt.FloorPathEndN,[68]),t.set(rt.FloorPathEndS,[89]),t.set(rt.FloorPathEndW,[69]),t.set(rt.FloorPathEndE,[70]),t.set(rt.FloorPathTurnSE,[5]),t.set(rt.FloorPathTurnSW,[7]),t.set(rt.FloorPathTurnNE,[47]),t.set(rt.FloorPathTurnNW,[49]),t.set(rt.FloorUnit,[91]),t.set(rt.StepsUp,[10]),t.set(rt.StepsUpEdged,[11]),t.set(rt.StepsShadow,[9]),t.set(rt.StepsShadowEdged,[32]),t.set(rt.Void,[53]),t.set(rt.VoidDrop,[90]),t.set(rt.VoidDropFromWall,[102]),t.set(rt.Water,[34]),t.set(rt.WaterEdgeN,[13]),t.set(rt.WaterEdgeS,[55]),t.set(rt.WaterEdgeE,[35]),t.set(rt.WaterEdgeW,[33]),t.set(rt.WaterEdgeNE,[14]),t.set(rt.WaterEdgeNW,[12]),t.set(rt.WaterEdgeSE,[56]),t.set(rt.WaterEdgeSW,[54]),t.set(rt.WaterCornerSE,[15]),t.set(rt.WaterCornerSW,[16]),t.set(rt.WaterCornerNE,[36]),t.set(rt.WaterCornerNW,[37]),t.set(rt.WaterPathV,[59]),t.set(rt.WaterPathH,[75]),t.set(rt.WaterPathEndN,[96]),t.set(rt.WaterPathEndS,[97]),t.set(rt.WaterPathEndW,[98]),t.set(rt.WaterPathEndE,[99]),t.set(rt.WaterPathTurnSE,[74]),t.set(rt.WaterPathTurnSW,[76]),t.set(rt.WaterPathTurnNE,[77]),t.set(rt.WaterPathTurnNW,[78]),t.set(rt.WaterPathEndNDrop,[83]),t.set(rt.WaterPathEndSDrop,[104]),t.set(rt.WaterPathEndEDrop,[103]),t.set(rt.WaterPathEndWDrop,[82]),t.set(rt.WaterDrop,[57]),t.set(rt.WallWaterGrate,[94,93,92]),t}(),n=function(){let t=void 0;return[[rt.FloorUnit,nt.Floor,nt.Void,nt.Void,nt.Void,nt.Void],[rt.FloorPathH,nt.Floor,nt.Void,nt.Void],[rt.FloorPathV,nt.Floor,t,t,nt.Void,nt.Void],[rt.FloorPathTurnNE,nt.Floor,nt.Floor,nt.Void,nt.Floor,nt.Void,nt.Void],[rt.FloorPathTurnNW,nt.Floor,nt.Floor,nt.Void,nt.Void,nt.Floor,t,t,t,nt.Void],[rt.FloorPathTurnSE,nt.Floor,nt.Void,nt.Floor,nt.Floor,nt.Void,t,nt.Void],[rt.FloorPathTurnSW,nt.Floor,nt.Void,nt.Floor,nt.Void,nt.Floor,t,t,nt.Void],[rt.FloorPathEndN,nt.Floor,nt.Void,t,nt.Void,nt.Void],[rt.FloorPathEndS,nt.Floor,t,nt.Void,nt.Void,nt.Void],[rt.FloorPathEndW,nt.Floor,nt.Void,nt.Void,t,nt.Void],[rt.FloorPathEndE,nt.Floor,nt.Void,nt.Void,nt.Void],[rt.FloorEdgeNE,nt.Floor,nt.Void,t,nt.Void],[rt.FloorEdgeNW,nt.Floor,nt.Void,t,t,nt.Void],[rt.FloorEdgeSE,nt.Floor,t,nt.Void,nt.Void],[rt.FloorEdgeSW,nt.Floor,t,nt.Void,t,nt.Void],[rt.FloorEdgeN,nt.Floor,nt.Void],[rt.FloorEdgeS,nt.Floor,t,nt.Void],[rt.FloorEdgeE,nt.Floor,t,t,nt.Void],[rt.FloorEdgeW,nt.Floor,t,t,t,nt.Void],[rt.FloorCornerNE,nt.Floor,t,t,t,t,nt.Void],[rt.FloorCornerNW,nt.Floor,t,t,t,t,t,t,t,nt.Void],[rt.FloorCornerSE,nt.Floor,t,t,t,t,t,nt.Void],[rt.FloorCornerSW,nt.Floor,t,t,t,t,t,t,nt.Void],[rt.VoidDropFromWall,nt.Void,t,t,t,t,t,t,t,t,nt.Wall,t],[rt.VoidDrop,nt.Void,t,t,t,t,t,t,t,t,nt.Floor,t],[rt.WaterPathEndSDrop,nt.Water,nt.Water,nt.Void],[rt.WaterPathEndWDrop,nt.Water,t,t,nt.Water,nt.Void],[rt.WaterPathH,nt.Water,nt.Floor,nt.Floor],[rt.WaterPathV,nt.Water,t,t,nt.Floor,nt.Floor],[rt.WaterPathTurnNE,nt.Water,nt.Water,nt.Floor,nt.Water,nt.Floor,nt.Floor],[rt.WaterPathTurnNW,nt.Water,nt.Water,nt.Floor,nt.Floor,nt.Water,t,t,t,nt.Floor],[rt.WaterPathTurnSE,nt.Water,nt.Floor,nt.Water,nt.Water,nt.Floor,t,nt.Floor],[rt.WaterPathTurnSW,nt.Water,nt.Floor,nt.Water,nt.Floor,nt.Water,t,t,nt.Floor],[rt.WaterPathEndN,nt.Water,nt.Floor,t,nt.Floor,nt.Floor],[rt.WaterPathEndS,nt.Water,t,nt.Floor,nt.Floor,nt.Floor],[rt.WaterPathEndW,nt.Water,nt.Floor,nt.Floor,t,nt.Floor],[rt.WaterPathEndE,nt.Water,nt.Floor,nt.Floor,nt.Floor],[rt.WaterEdgeNE,nt.Water,nt.Floor,t,nt.Floor],[rt.WaterEdgeNW,nt.Water,nt.Floor,t,t,nt.Floor],[rt.WaterEdgeSE,nt.Water,t,nt.Floor,nt.Floor],[rt.WaterEdgeSW,nt.Water,t,nt.Floor,t,nt.Floor],[rt.WaterEdgeN,nt.Water,nt.Floor],[rt.WaterEdgeS,nt.Water,t,nt.Floor],[rt.WaterEdgeE,nt.Water,t,t,nt.Floor],[rt.WaterEdgeW,nt.Water,t,t,t,nt.Floor],[rt.WaterCornerNE,nt.Water,t,t,t,t,nt.Floor],[rt.WaterCornerNW,nt.Water,t,t,t,t,t,t,t,nt.Floor],[rt.WaterCornerSE,nt.Water,t,t,t,t,t,nt.Floor],[rt.WaterCornerSW,nt.Water,t,t,t,t,t,t,nt.Floor],[rt.WaterDrop,nt.Void,t,t,t,t,t,t,t,t,nt.Water],[rt.WaterPathV,nt.Water,nt.Wall,nt.Water,nt.Floor,nt.Floor],[rt.WaterPathTurnNE,nt.Water,nt.Wall,nt.Floor,nt.Water,nt.Floor],[rt.WaterPathTurnNW,nt.Water,nt.Wall,nt.Floor,nt.Floor,nt.Water],[rt.WallWaterGrate,nt.Wall,t,nt.Water,t,t,t,nt.Floor,nt.Floor,t],[rt.StepsUp,nt.StepsDown,t,t,nt.StepsDown],[rt.StepsUp,nt.StepsDown,t,t,t,nt.StepsDown],[rt.StepsUpEdged,nt.StepsDown],[rt.WallLower,nt.Wall,t,nt.Floor],[rt.WallLower,nt.Wall,t,nt.Water],[rt.Void,nt.Void],[rt.Floor,nt.Floor],[rt.Water,nt.Water],[rt.WallUpper,nt.Wall]]}(),r=new Array(t[0].length);for(let a=0,o=r.length;a<o;a++){r[a]=new Array(t[0][a].length);for(let o=0,h=r.length;o<h;o++){let h,l,d,c,u,_,m,p,g,f=nt.Void,w=e<t.length-1?t[e+1][a][o]:f,v=e>0?t[e-1][a][o]:f,y=s?s[a][o]:f;s&&(h=o>0?s[a][o-1]:f,l=o<s[a].length-1?s[a][o+1]:f,d=a<s.length-1?s[a+1][o]:f,c=a>0?s[a-1][o]:f,u=o>0&&a<s.length-1?s[a+1][o-1]:f,_=o<s[a].length-1&&a<s.length-1?s[a+1][o+1]:f,m=o<s[a].length-1&&a>0?s[a-1][o+1]:f,p=o>0&&a>0?s[a-1][o-1]:f,g=e<t.length-1&&o>0?t[e+1][a][o-1]:f);let D=[y,h,l,d,c,u,_,m,p,w,v,g];r[a][o]=ct(ut(D,n),i)}}return r}function ct(t,e){let s=e.get(t);return s?s[Math.round(Math.random()*(s.length-1))]:(console.warn("No tile for Extended Tile Type",t),0)}function ut(t,e){for(let s=0;s<e.length;s++){let i=!1;for(let n=1;n<e[s].length;n++)if(void 0!==e[s][n]&&e[s][n]!==t[n-1]){i=!0;break}if(!i)return e[s][0]}console.warn("Missing rule for floor combination",t)}!function(t){t[t.Floor=0]="Floor",t[t.Void=1]="Void",t[t.Water=2]="Water",t[t.Wall=3]="Wall",t[t.StepsDown=4]="StepsDown"}(nt||(nt={})),function(t){t[t.Floor=0]="Floor",t[t.WallUpper=1]="WallUpper",t[t.WallLower=2]="WallLower",t[t.FloorEdgeN=3]="FloorEdgeN",t[t.FloorEdgeS=4]="FloorEdgeS",t[t.FloorEdgeE=5]="FloorEdgeE",t[t.FloorEdgeW=6]="FloorEdgeW",t[t.FloorEdgeNW=7]="FloorEdgeNW",t[t.FloorEdgeNE=8]="FloorEdgeNE",t[t.FloorEdgeSW=9]="FloorEdgeSW",t[t.FloorEdgeSE=10]="FloorEdgeSE",t[t.FloorCornerSE=11]="FloorCornerSE",t[t.FloorCornerSW=12]="FloorCornerSW",t[t.FloorCornerNE=13]="FloorCornerNE",t[t.FloorCornerNW=14]="FloorCornerNW",t[t.FloorPathV=15]="FloorPathV",t[t.FloorPathH=16]="FloorPathH",t[t.FloorPathEndN=17]="FloorPathEndN",t[t.FloorPathEndS=18]="FloorPathEndS",t[t.FloorPathEndW=19]="FloorPathEndW",t[t.FloorPathEndE=20]="FloorPathEndE",t[t.FloorPathTurnSE=21]="FloorPathTurnSE",t[t.FloorPathTurnSW=22]="FloorPathTurnSW",t[t.FloorPathTurnNE=23]="FloorPathTurnNE",t[t.FloorPathTurnNW=24]="FloorPathTurnNW",t[t.FloorUnit=25]="FloorUnit",t[t.Void=26]="Void",t[t.VoidDrop=27]="VoidDrop",t[t.VoidDropFromWall=28]="VoidDropFromWall",t[t.Water=29]="Water",t[t.WaterEdgeN=30]="WaterEdgeN",t[t.WaterEdgeE=31]="WaterEdgeE",t[t.WaterEdgeS=32]="WaterEdgeS",t[t.WaterEdgeW=33]="WaterEdgeW",t[t.WaterEdgeNE=34]="WaterEdgeNE",t[t.WaterEdgeNW=35]="WaterEdgeNW",t[t.WaterEdgeSE=36]="WaterEdgeSE",t[t.WaterEdgeSW=37]="WaterEdgeSW",t[t.WaterCornerSE=38]="WaterCornerSE",t[t.WaterCornerSW=39]="WaterCornerSW",t[t.WaterCornerNE=40]="WaterCornerNE",t[t.WaterCornerNW=41]="WaterCornerNW",t[t.WaterDrop=42]="WaterDrop",t[t.WaterPathV=43]="WaterPathV",t[t.WaterPathH=44]="WaterPathH",t[t.WaterPathEndN=45]="WaterPathEndN",t[t.WaterPathEndS=46]="WaterPathEndS",t[t.WaterPathEndW=47]="WaterPathEndW",t[t.WaterPathEndE=48]="WaterPathEndE",t[t.WaterPathTurnSE=49]="WaterPathTurnSE",t[t.WaterPathTurnSW=50]="WaterPathTurnSW",t[t.WaterPathTurnNE=51]="WaterPathTurnNE",t[t.WaterPathTurnNW=52]="WaterPathTurnNW",t[t.WaterPathEndWDrop=53]="WaterPathEndWDrop",t[t.WaterPathEndSDrop=54]="WaterPathEndSDrop",t[t.WaterPathEndNDrop=55]="WaterPathEndNDrop",t[t.WaterPathEndEDrop=56]="WaterPathEndEDrop",t[t.WallWaterGrate=57]="WallWaterGrate",t[t.StepsUpEdged=58]="StepsUpEdged",t[t.StepsShadowEdged=59]="StepsShadowEdged",t[t.StepsUp=60]="StepsUp",t[t.StepsShadow=61]="StepsShadow"}(rt||(rt={}));class _t extends et{constructor(t,e,s,i,n){super(t,e),this._data=s,this._localData=i,this._layer=n}load(t){return this.addAsset(t.loadImage(ot.a,()=>{})),!0}create(t,e,s){super.create(t,e,s);let i=new ht(this.getAsset(ot.a),16,16);i.setEmptySprite(53),0===this._layer&&this.addChild(new lt(new f(new Y(0,this._localData.tileSize)),p.fill,dt(this._data.map,-1),i)),this.addChild(new lt(new f,p.fill,dt(this._data.map,this._layer),i))}}var mt,pt=s(0),gt=s.n(pt);!function(t){t[t.Agent=0]="Agent",t[t.Projectile=1]="Projectile"}(mt||(mt={}));class ft extends k{constructor(t,e,s,i,n){super(t,e),this._teamsColours=["red","green","blue"],this._data=s,this._localData=i,this._bufferedMaps=n}load(t){return this.addAsset(t.loadImage(gt.a,()=>{console.warn("Image failed to load:"+gt.a)})),!0}create(){this._drawableSpriteSheet=new ht(this.getAsset(gt.a),20,20)}draw(t){let e=this._localData.worldScale,s=0,i=this.transform.position.x()-t.x(),n=this.transform.position.y()-t.y(),r=this.transform.bounds.width(),a=this.transform.bounds.height();for(let o=0,h=this._data.drawables.length;o<h;o++){let h=this._data.drawables[o];if(!h.isInUse())break;for(;h.getZ()>=s&&s<this._bufferedMaps.length;)t.context2D.drawImage(this._bufferedMaps[s].mainCamera.canvas,i,n-s*e,r,a),s++;let l=Math.round(h.getX()*e+i)-h.getWidth()*e,d=Math.round(h.getY()*e+n)-h.getHeight()*e-h.getZ()*e;if(h.getType()===mt.Agent){let s=h;this._drawableSpriteSheet.draw(t.context2D,l,d,s.team%3,s.collideRadius*e*2,s.collideRadius*e*2),s.health<s.maxHealth&&(t.context2D.fillStyle="darkred",t.context2D.fillRect(l,d,s.collideRadius*e*2,this._localData.baseZoom),t.context2D.fillStyle="red",t.context2D.fillRect(l,d,s.collideRadius*e*2*s.health/s.maxHealth,this._localData.baseZoom))}else if(h.getType()===mt.Projectile){let s=h;t.context2D.fillStyle=this._teamsColours[s.team%this._teamsColours.length],t.context2D.fillRect(l,d,s.collideRadius*e*2,s.collideRadius*e*2)}}for(;s<this._bufferedMaps.length;)t.context2D.drawImage(this._bufferedMaps[s].mainCamera.canvas,i,n-s*e,r,a),s++}}class wt extends k{constructor(t,e,s,i){super(t,e),this._bufferedMaps=[],this._data=s,this._localData=i}create(){this.addChild(new q(new f,p.fill,"#211e27")),this._worldDB=this.addChild(this._createWorldDB());for(let t=0;t<this._data.map.length;t++)this._bufferedMaps.push(this._worldDB.addChild(new _t(null,new p(new N(this._worldWidth(),this._worldHeight())),this._data,this._localData,t)));let t=this._worldDB.addChild(this._createWorldContainer());t.addChild(new ft(new f,p.fill,this._data,this._localData,this._bufferedMaps)),this._createCamera(this._worldDB,t),this.addChild(this._createWorldClone(new f(new g(.5,.5,new i(.5,.5))),p.fill,this._worldDB))}update(){this._localData.viewportWidth=this._worldDB.transform.bounds.width(),this._localData.viewportHeight=this._worldDB.transform.bounds.height(),this._worldDB.requestDraw()}_createWorldClone(t,e,s){let i=new X(t,e,s.mainCamera);return i.imageSmoothingEnabled=!1,i.transform.bounds.maxDimension=new N((this._worldWidth()+2*this._worldPadding())*this._localData.baseZoom,(this._worldHeight()+2*this._worldPadding())*this._localData.baseZoom),i}_createWorldDB(){let t=new et(null,p.fill,!1);return t.transform.bounds.maxDimension=new N((this._worldWidth()+2*this._worldPadding())*this._localData.baseZoom,(this._worldHeight()+2*this._worldPadding())*this._localData.baseZoom),t}_createWorldContainer(){return new k(new f(new Y(this._worldPadding()*this._localData.baseZoom,this._worldPadding()*this._localData.baseZoom)),new p(new N(this._worldWidth()*this._localData.baseZoom,this._worldHeight()*this._localData.baseZoom)))}_createCamera(t,e){let s=new o(1,1,t.transform.bounds),i=e.addChild(new it(new f,new p(s),s,this._localData));i.imageSmoothingEnabled=!1,t.mainCamera=t.addCamera(i)}_worldWidth(){return this._data.map[0].length*this._localData.tileSize}_worldHeight(){return this._data.map[0][0].length*this._localData.tileSize}_worldPadding(){return this._localData.sidePadding*this._localData.tileSize}}class vt extends k{constructor(){super(...arguments),this.typeName="DebugPane",this._beginTime=0,this._drawTime=0,this._endTime=0,this._updateTime=0,this._averageSteps=0,this._loopTime=0,this._valuesAlpha=.02}create(t,e){this._timingText=this.addChild(new I(new f(new Y(5,5)),new p,"FPS:",new V("white",12,"serif",2,void 0,!1))),this.addChild(new B).getKeyEvent("Tab",W.onKeyUp).push(()=>this.visible=!this.visible,this)}updateValues(t,e,s){this._beginTime=this.runningAverage(this._beginTime,t.beginTime,this._valuesAlpha),this._updateTime=this.runningAverage(this._updateTime,t.updateTime,this._valuesAlpha),this._drawTime=this.runningAverage(this._drawTime,t.drawTime,this._valuesAlpha),this._endTime=this.runningAverage(this._endTime,t.endTime,this._valuesAlpha),this._loopTime=this.runningAverage(this._loopTime,t.loopTime,this._valuesAlpha),this._averageSteps=this.runningAverage(this._averageSteps,s,this._valuesAlpha),this._slowDown=t.slowDown}begin(t,e,s){this._timingText.text=("FPS: "+t.fps).substring(0,7)+("\nBegin: "+this._beginTime).substring(0,12)+("\nDraw: "+this._drawTime).substring(0,11)+("\nUpdate: "+this._updateTime).substring(0,13)+("\n(Steps: "+this._averageSteps).substring(0,13)+") "+("\nEnd: "+this._endTime).substring(0,10)+("\nLoop: "+this._loopTime).substring(0,11)+("\n(Calculated FPS: "+Math.round(1e3/this._loopTime)).substring(0,21)+")"+("\n(Rate (-/+): "+100/(this._slowDown+1)).substring(0,17)+"%)"+("\n(Game Speed ([/]): "+100*t.speedFactor).substring(0,23)+"%)"}runningAverage(t,e,s){return s*e+(1-s)*t}}class yt{constructor(){this.loopStart=0,this.loopTime=0,this.beginStart=0,this.beginTime=0,this.updateStart=0,this.updateTime=0,this.drawStart=0,this.drawTime=0,this.endStart=0,this.endTime=0,this.slowDown=0}onBeginStart(){this.loopStart=performance.now(),this.beginStart=this.loopStart}onBeginEnd(){let t=performance.now();this._delay((t-this.beginStart)*this.slowDown),this.beginTime=t-this.beginStart}onUpdateStart(){this.updateStart=performance.now()}onUpdateEnd(){let t=performance.now();this._delay((t-this.updateStart)*this.slowDown),this.updateTime=t-this.updateStart}onDrawStart(){this.drawStart=performance.now()}onDrawEnd(){let t=performance.now();this._delay((t-this.drawStart)*this.slowDown),this.drawTime=t-this.drawStart}onEndStart(){this.endStart=performance.now()}onEndEnd(){let t=performance.now();this._delay((t-this.endStart)*this.slowDown),this.endTime=t-this.endStart,this.loopTime=t-this.loopStart}_delay(t){if(t<=0)return;let e=performance.now(),s=e;for(;s=performance.now(),!(s-e>t););}}let Dt={rootGameObjectType:class extends et{constructor(){super(...arguments),this.typeName="Editor",this._timings=new yt}create(t,e,s){super.create(t,e,s),this.addChild(new q(new f,p.fill,"#1e1e1e")),e.launcherOptions.args.editor&&(this._game=this.addChild(this._createBufferedGame(e)),this._usesMouse=e.launcherOptions.args.editor.usesMouse,this._usesKeyboard=e.launcherOptions.args.editor.usesKeyboard),this._debugPane=this.addChild(new vt(new f,p.fill)),this.addChild(new B).getKeyEvent("Pause",W.onKeyNewDown).push(()=>{this._game.active=!this._game.active,this._debugPane.active=this._game.active})}doBegin(t,e,s,i){this._timings.onBeginStart(),super.doBegin(t,e,s,i),this._timings.onBeginEnd()}begin(t,e,s){if(super.begin(t,e,s),this.interactable)for(let e=0,i=s.keyboard.keysDown.length;e<i;e++){let i=s.keyboard.keysDown[e];"-"===i?this._timings.slowDown+=1*t.rawDeltaSeconds:"+"===i&&(this._timings.slowDown=Math.max(0,this._timings.slowDown-1*t.rawDeltaSeconds)),"["===i?t.speedFactor=Math.max(0,t.speedFactor-.15*t.rawDeltaSeconds):"]"===i&&(t.speedFactor=Math.min(2,t.speedFactor+.15*t.rawDeltaSeconds))}this._debugPane.updateValues(this._timings,t.fps,t.updateSteps)}doUpdate(t){this._timings.onUpdateStart(),super.doUpdate(t),this._timings.onUpdateEnd()}doDraw(t){this._timings.onDrawStart(),super.doDraw(t),this._timings.onDrawEnd()}doEnd(t){this._timings.onEndStart(),super.doEnd(t),this._timings.onEndEnd()}_createBufferedGame(t){let e=new t.launcherOptions.args.editor.rootGameObjectType(f.centre,new p(new o(1,1)));return e instanceof et&&(e.mainCamera.backgroundColor=t.launcherOptions.args.editor.backgroundColor,e.mainCamera.hasAlphaChannel=t.launcherOptions.args.editor.hasAlphaChannel),e.transform.bounds.minDimension=t.launcherOptions.args.editor.minDimension,e.transform.bounds.maxDimension=t.launcherOptions.args.editor.maxDimension,e}},minDimension:void 0,maxDimension:void 0,backgroundColor:"white",hasAlphaChannel:!1,usesMouse:!0,usesKeyboard:!0,addExtraInputDevices:t=>{},gameTarget:"gameTarget",windowVariableName:void 0,args:{}};let bt=function(t){let e=Dt;return e.addExtraInputDevices=t.addExtraInputDevices,e.gameTarget=t.gameTarget,e.windowVariableName=t.windowVariableName,e.args=t.args,e.args.editor=t,e}({rootGameObjectType:class extends k{constructor(){super(...arguments),this.typeName="GameRoot",this._updateCommand=new A(S.Update,0)}create(t,e,s){super.create(t,e,s),this._localData=new w;let i=new v;this._scenario=this._createScenario(this._localData,i),this._controller=this._createModelController(i),this.addChild(new wt(new f,p.fill,this._scenario.data,this._localData)),this.addChild(new L(this._controller)),this.addChild(new O(new f,p.fill,this._controller))}update(t){this._scenario.update(t.deltaSeconds),this._updateCommand.arg=t.deltaSeconds,this._controller.recieveCommand(this._updateCommand)}_createScenario(t,e){let s=window.FBScenario;if(!s)throw new Error("No scenario detected in environment. Ensure scenario script has loaded.");let i=s.addLocalClient(e);return i?console.log("Local player connected"):console.log("Scenario full, no local player connected"),t.playing=i,s.create(),s}_createModelController(t){let e=new D;return new E(this._scenario.data,this._localData,t).create(e),new y(e)}},minDimension:void 0,maxDimension:void 0,backgroundColor:"white",hasAlphaChannel:!1,usesMouse:!0,usesKeyboard:!0,addExtraInputDevices:t=>{},gameTarget:"gameTarget",windowVariableName:void 0,args:{}});class xt{constructor(){this._inputDevices={},this._ifs=[]}get inputDevices(){return this._inputDevices}onBeginEnd(){for(let t=0,e=this._ifs.length;t<e;t++)this._ifs[t].onBeginEnd()}addInputDevice(t,e){this._inputDevices[e]=t,this._ifs.push(t)}}class St{constructor(t,e,s,i){this._simulationTimestep=1e3/60,this._frameDelta=0,this._lastFrameTimeMs=0,this._fps=60,this._fpsAlpha=.9,this._fpsUpdateInterval=1e3,this._lastFpsUpdate=0,this._framesSinceLastFpsUpdate=0,this._numUpdateSteps=0,this._minFrameDelay=0,this._running=!1,this._started=!1,this._panic=!1,this._hasWindow="object"==typeof window,this._lastTimestampForTimeoutMethod=Date.now(),this._begin=t,this._update=e,this._draw=s,this._end=i,this._animateBoundCall=this._animate.bind(this)}get numUpdateSteps(){return this._numUpdateSteps}get simulationTimestep(){return this._simulationTimestep}set simulationTimestep(t){this._simulationTimestep=t}get fps(){return this._fps}get maxAllowedFPS(){return 1e3/this._minFrameDelay}set maxAllowedFPS(t){void 0===t&&(t=1/0),0===t?this.stop():this._minFrameDelay=1e3/t}get running(){return this._running}resetFrameDelta(){var t=this._frameDelta;return this._frameDelta=0,t}start(){return this._started||(this._started=!0,this._rafHandle=this._requestAnimationFrame(t=>{this._draw(1),this._running=!0,this._lastFrameTimeMs=t,this._lastFpsUpdate=t,this._framesSinceLastFpsUpdate=0,this._rafHandle=this._requestAnimationFrame(this._animateBoundCall)})),this}stop(){return this._running=!1,this._started=!1,this._cancelAnimationFrame(this._rafHandle),this}_requestAnimationFrame(t){return this._hasWindow?window.requestAnimationFrame(t):this._timeoutAnimationFrame(t)}_timeoutAnimationFrame(t){let e=Date.now(),s=Math.max(0,this._simulationTimestep-(e-this._lastTimestampForTimeoutMethod));return this._lastTimestampForTimeoutMethod=e+s,setTimeout((function(){t(e+s)}),s)}_cancelAnimationFrame(t){this._hasWindow?cancelAnimationFrame(t):clearTimeout(t)}_animate(t){if(this._rafHandle=this._requestAnimationFrame(this._animateBoundCall),!(t<this._lastFrameTimeMs+this._minFrameDelay)){for(this._frameDelta+=t-this._lastFrameTimeMs,this._lastFrameTimeMs=t,this._begin(t,this._frameDelta),t>this._lastFpsUpdate+this._fpsUpdateInterval&&(this._fps=this._fpsAlpha*this._framesSinceLastFpsUpdate*1e3/(t-this._lastFpsUpdate)+(1-this._fpsAlpha)*this._fps,this._lastFpsUpdate=t,this._framesSinceLastFpsUpdate=0),this._framesSinceLastFpsUpdate++,this._numUpdateSteps=0;this._frameDelta>=this._simulationTimestep;)if(this._update(this._simulationTimestep),this._frameDelta-=this._simulationTimestep,++this._numUpdateSteps>=240){this._panic=!0;break}this._draw(this._frameDelta/this._simulationTimestep),this._end(this._fps,this._panic),this._panic=!1}}}class Wt{constructor(t,e,s,i,n){this._created=!1,this._rootGameObject=t,this._inputDevices=e,this._timing=s,this._loader=i,this._environment=n}create(){if(this._created)throw new Error("Cannot create Game: already created");this._mainLoop=new St(this._begin.bind(this),this._update.bind(this),this._draw.bind(this),this._end.bind(this)),this._rootGameObject.doCreate(this._timing,this._loader,this._environment,this._inputDevices.inputDevices),this._created=!0}start(){if(!this._created)throw new Error("Cannot start Game: not yet created");this._mainLoop.start()}stop(){this._mainLoop.stop()}draw(){this._rootGameObject.doDraw(null)}_begin(t,e){this._timing.mainLoopTimestamp=t,this._timing.setDeltas(e),this._timing.updateSteps=this._mainLoop.numUpdateSteps,this._environment.checkFullscreenState(),this._rootGameObject.doBegin(this._timing,this._loader,this._environment,this._inputDevices.inputDevices),this._inputDevices.onBeginEnd()}_update(t){this._timing.setDeltas(t),this._rootGameObject.doUpdate(this._timing)}_draw(t){this._rootGameObject.doDraw(null)}_end(t,e){this._timing.fps=t,this._rootGameObject.doEnd(this._timing),e&&this._mainLoop.resetFrameDelta()}}class Et{constructor(){this.fps=0,this.updateSteps=0,this.mainLoopTimestamp=0,this.rawDelta=0,this.rawDeltaSeconds=0,this.delta=0,this.deltaSeconds=0,this.speedFactor=1}setDeltas(t){this.rawDelta=t,this.rawDeltaSeconds=t/1e3,1===this.speedFactor?(this.delta=t,this.deltaSeconds=this.rawDeltaSeconds):(this.delta=t*this.speedFactor,this.deltaSeconds=this.delta/1e3)}}class Ft{constructor(t,e,s){this._filename=t,this._asset=e,this._loaded=s}get filename(){return this._filename}get asset(){return this._asset}get loaded(){return this._loaded}set loaded(t){this._loaded=t}set(t){this._asset=t}}s(2);class Tt{constructor(t){this._assetsFolder="./",this._sharedAssets=[],void 0!==t&&(this._assetsFolder=t)}get assetsFolder(){return this._assetsFolder}getSharedAsset(t){let e;for(let s=0,i=this._sharedAssets.length;s<i;s++)if(this._sharedAssets[s].filename===t){e=this._sharedAssets[s];break}if(e)return e;let s=new Ft(t,null,!1);return this._sharedAssets.push(s),s}loadImage(t,e){let s=new Image,i=new Ft(t,s,!1);return s.src=this.assetsFolder+t,s.onload=function(){i.loaded=!0,s.onload=null,s.onerror=null},s.onerror=()=>{s.onload=null,s.onerror=null,e(i)},i}loadFont(t,e,s,...i){return new Ft(t,e,!0)}}class Ct{constructor(){this._bufferSizes=10,this._keysDown=[],this._keysDownLength=0,this._keysUp=[],this._keysUpLength=0,this._keyPressesThisUpdate=[],this._keyPressesThisUpdateLength=0;for(let t=0,e=this._bufferSizes;t<e;t++)this._keysDown.push(null),this._keysUp.push(null),this._keyPressesThisUpdate.push(null)}get keyPressesThisUpdate(){return this._keyPressesThisUpdate}get keysDown(){return this._keysDown}get keysUp(){return this._keysUp}isKeyUp(t){for(let e=0,s=this._keysUpLength;e<s;e++)if(this._keysUp[e]===t)return!0;return!1}isKeyDown(t){for(let e=0,s=this._keysDownLength;e<s;e++)if(this._keysDown[e]===t)return!0;return!1}isKeyPressed(t){for(let e=0,s=this._keyPressesThisUpdateLength;e<s;e++)if(this._keyPressesThisUpdate[e]===t)return!0;return!1}keyPriority(t,e){let s=-1,i=-1;for(let n=0,r=this._keysDownLength;n<r&&!(this._keysDown[n]===t&&(s=n,i>-1))&&!(this._keysDown[n]===e&&(i=n,s>-1));n++);return s>i}onBeginEnd(){this._keyPressesThisUpdateLength=0;for(let t=0,e=this._keysUpLength;t<e;t++)for(let e=0,s=this._keysDownLength;e<s;e++)if(this._keysUp[t]===this._keysDown[e]){C(this._keysDown,e,this._keysDownLength-1),this._keysDownLength--;break}this._keysUpLength=0}keyDown(t){if(t.defaultPrevented)return;let e=!1;if(this._keysDownLength<this._bufferSizes)for(let s=0,i=this._keysDownLength;s<i;s++)if(this._keysDown[s]===t.key){e=!0;break}e||(this._keysDown[this._keysDownLength]=t.key,this._keysDownLength++)}keyUp(t){if(t.defaultPrevented)return;let e=!1;if(this._keysUpLength<this._bufferSizes)for(let s=0,i=this._keysUpLength;s<i;s++)if(this._keysUp[s]===t.key){e=!0;break}e||(this._keysUp[this._keysUpLength]=t.key,this._keysUpLength++)}keyPress(t){if(t.defaultPrevented)return;let e=!1;if(this._keyPressesThisUpdateLength<this._bufferSizes)for(let s=0,i=this._keyPressesThisUpdateLength;s<i;s++)if(this._keyPressesThisUpdate[s]===t.key){e=!0;break}e||(this._keyPressesThisUpdate[this._keyPressesThisUpdateLength]=t.key,this._keyPressesThisUpdateLength++)}}class kt{constructor(t){this.x=0,this.y=0,this.isStartEvent=!1,this.isEndEvent=!1,this.isMoveEvent=!1,this.handled=!1,this.isDown=!1,this.id=t}}class Rt extends class{onBeginEnd(){}}{constructor(t,e){super(),this.pointers=[],this.wheelY=0,this.wheelEvent=!1,this.onClickAsync=new m,this.maxPointers=t;for(let e=0;e<t;e++)this.pointers.push(new kt(e));this._htmlElementForOffset=e}get htmlElementForOffset(){return this._htmlElementForOffset}set htmlElementForOffset(t){this._htmlElementForOffset=t}handleAll(){for(let t=0,e=this.pointers.length;t<e;t++)this.pointers[t].handled=!0}onBeginEnd(){for(let t=0,e=this.pointers.length;t<e;t++)this.pointers[t].isStartEvent=!1,this.pointers[t].isEndEvent=!1,this.pointers[t].isMoveEvent=!1,this.pointers[t].handled=!1;this.wheelEvent=!1}mouseUp(t){this.pointers[0].isEndEvent=!0,this.pointers[0].isDown=!1,this.onClickAsync.call(this,this.pointers[0])}touchEnd(t){for(let e=1,s=t.changedTouches.length;e<s;e++)t.changedTouches[e].identifier+1<this.maxPointers&&(this.pointers[t.changedTouches[e].identifier+1].isEndEvent=!0,this.pointers[t.changedTouches[e].identifier+1].isDown=!1,this.pointers[t.changedTouches[e].identifier+1].x=t.changedTouches[e].pageX-this._htmlElementForOffset.offsetLeft,this.pointers[t.changedTouches[e].identifier+1].y=t.changedTouches[e].pageY-this._htmlElementForOffset.offsetTop,this.onClickAsync.length>0&&this.onClickAsync.call(this,this.pointers[t.changedTouches[e].identifier+1]))}mouseDown(t){this.pointers[0].isDown=!0,this.pointers[0].isStartEvent=!0,this.pointers[0].x=t.pageX-this._htmlElementForOffset.offsetLeft,this.pointers[0].y=t.pageY-this._htmlElementForOffset.offsetTop}touchStart(t){for(let e=0,s=t.changedTouches.length;e<s;e++)if(t.changedTouches[e].identifier+1<this.maxPointers){let s=this.pointers[t.changedTouches[e].identifier+1];s.isDown=!0,s.isEndEvent=!1,s.isMoveEvent=!1,s.handled=!1,s.isStartEvent=!0,s.x=t.changedTouches[e].pageX-this._htmlElementForOffset.offsetLeft,s.y=t.changedTouches[e].pageY-this._htmlElementForOffset.offsetTop}}mouseXY(t){this.pointers[0].isMoveEvent=!0,this.pointers[0].x=t.pageX-this._htmlElementForOffset.offsetLeft,this.pointers[0].y=t.pageY-this._htmlElementForOffset.offsetTop}touchXY(t){t.preventDefault();for(let e=0,s=t.changedTouches.length;e<s;e++)if(t.changedTouches[e].identifier+1<this.maxPointers){let s=this.pointers[t.changedTouches[e].identifier+1];s.isMoveEvent=!0,s.x=t.changedTouches[e].pageX-this._htmlElementForOffset.offsetLeft,s.y=t.changedTouches[e].pageY-this._htmlElementForOffset.offsetTop}}onWheelEvent(t){let e=t.deltaY;this.wheelY=0===e?0:e>0?1:-1,this.wheelEvent=!0}}class Pt{constructor(t,e,s,i,n){this.onFullscreenChange=new u,this.onResize=new _,this._isFullscreen=!1,this._devicePixelRatio=t,this._urlArgs=e,this._launcherOptions=i,this._document=n}get gameWidth(){return this._gameWidth}get gameHeight(){return this._gameHeight}get isFullscreen(){return this._isFullscreen}get devicePixelRatio(){return this._devicePixelRatio}get launcherOptions(){return this._launcherOptions}get urlArgs(){return this._urlArgs}get activeContainer(){return this._activeContainer}set activeContainer(t){this._activeContainer=t}setWidthAndHeight(t,e){this._gameWidth=t,this._gameHeight=e,this.onResize.call(t,e)}requestFullscreen(){return!!this._activeContainer&&(this._activeContainer.requestFullscreen(),!0)}exitFullscreen(){this._document.exitFullscreen()}createCanvas(){return this._document.createElement("canvas")}addCanvasToPage(t,e){e.appendChild(t)}checkFullscreenState(){let t=!1,e=null!=this._document.fullscreenElement;e!==this._isFullscreen&&(t=!0),this._isFullscreen=e,t&&this.onFullscreenChange.call(this._isFullscreen)}}let Mt={createTiming:function(){return new Et},createLoader:function(){return new Tt},createKeyboard(t,e){let s=new Ct;return t.addEventListener("keydown",s.keyDown.bind(s),!0),t.addEventListener("keyup",s.keyUp.bind(s),!0),t.addEventListener("keypress",s.keyPress.bind(s),!0),s},createMouse:function(t,e){let s=new Rt(5,e);return t.body.addEventListener("mousedown",s.mouseDown.bind(s),!1),t.body.addEventListener("mousemove",s.mouseXY.bind(s),!1),t.body.addEventListener("touchstart",s.touchStart.bind(s),!1),t.body.addEventListener("touchmove",s.touchXY.bind(s),!0),t.body.addEventListener("touchend",s.touchEnd.bind(s),!1),t.body.addEventListener("mouseup",s.mouseUp.bind(s),!1),t.body.addEventListener("touchcancel",s.touchEnd.bind(s),!1),window.addEventListener("wheel",s.onWheelEvent.bind(s),!1),s},createEnvironment:function(t,e,s){let i=new Pt(window.devicePixelRatio,function(t){let e=[],s=new Map;return t.substr(1).split("&").forEach((function(t){e=t.split("="),s.set(decodeURIComponent(e[0]),decodeURIComponent(e[1]))})),s}(location.search),e,s,t);return window.addEventListener("resize",()=>i.setWidthAndHeight(e.offsetWidth,e.offsetHeight)),i},createRootGameObject:function(t,e,s){let i=new N(s.offsetWidth,s.offsetHeight),n=new e.rootGameObjectType(new f,new p(i));if(n.transform.bounds.minDimension=e.minDimension,n.transform.bounds.maxDimension=e.maxDimension,t.onResize.push((t,e)=>{i.width=t,i.height=e,n.transform.positioningIsDirty()}),n instanceof et){let e=n.addCamera(n.addChild(new tt(new f,p.fill)));e.hasAlphaChannel=t.launcherOptions.hasAlphaChannel,e.backgroundColor=t.launcherOptions.backgroundColor,e.container=s}return n}};let At=[];At=bt instanceof Array?bt:[bt],At.forEach(t=>{let e=document.querySelector("#"+t.gameTarget);if(!e)throw new Error("Cannot create game canvas in HTMLElement with ID '"+t.gameTarget+"'. No element with that name was found.");let s=function(t,e,s,i){i||(i=Mt);let n=i.createEnvironment(e,s,t);s.style.userSelect="none";let r=new xt;if(t.usesKeyboard){let t=i.createKeyboard(e,s);r.addInputDevice(t,"keyboard")}if(t.usesMouse){let t=i.createMouse(e,s);r.addInputDevice(t,"mouse")}t.addExtraInputDevices(r);let a=i.createTiming(),o=i.createLoader(),h=i.createRootGameObject(n,t,s);return new Wt(h,r,a,o,n)}(t,document,e);s.create(),s.start(),t.windowVariableName&&(window[t.windowVariableName]=s)})}]);